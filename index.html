<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#0f1220;
  color:#e9ecff;
}
#ui{
  max-width:800px;
  margin:40px auto;
  background:#161a2e;
  padding:26px;
  border-radius:18px;
  box-shadow:0 20px 60px rgba(0,0,0,.45);
}
button{
  padding:12px 20px;
  border:none;
  border-radius:14px;
  font-weight:700;
  background:#7cf3c0;
  cursor:pointer;
}
.row{display:flex;gap:12px;flex-wrap:wrap}
.badge{font-size:14px;margin-bottom:6px;color:#9aa3ff}
.progress{height:10px;background:#22286b;border-radius:999px;overflow:hidden;margin:12px 0}
.progress>div{height:100%;background:#7cf3c0}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
td,th{
  border:1px solid #2a2f6b;
  padding:10px;
  text-align:center;
  cursor:pointer;
}
td.selected{background:#7cf3c0;color:#06281a;font-weight:800}
.fade{
  animation:fadeSlide 2.5s ease forwards;
}
@keyframes fadeSlide{
  from{opacity:1;transform:translateX(0)}
  to{opacity:0;transform:translateX(-40px)}
}
</style>
</head>

<body>
<div id="ui"></div>

<script>
/* ===================== STATE / SAVE ===================== */
const state = JSON.parse(localStorage.getItem("survey_state")) || {
  step:0,
  coins:0,
  movieIndex:0,
  tableRatings:{},
  soundHeard:null
};
function save(){ localStorage.setItem("survey_state",JSON.stringify(state)); }

/* ===================== AUDIO ===================== */
function playSound(type, onEnd){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);

  if(type==="Birds"){ osc.type="sine"; osc.frequency.value=1200; }
  if(type==="Wolf"){ osc.type="sawtooth"; osc.frequency.value=220; }
  if(type==="Traffic"){ osc.type="square"; osc.frequency.value=90; }

  gain.gain.value=0.001;
  gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.1);

  osc.start();
  osc.stop(ctx.currentTime+14);

  osc.onended=()=>{
    ctx.close();
    onEnd && onEnd();
  };
}

/* ===================== MOVIES (MIXED) ===================== */
const movies=[
  "How to Train Your Dragon","Solar Drift","Echoes of Tomorrow",
  "The Last Moon","Pixel Knights","Iron Skies","Dreamfall City",
  "Neon Harbor","Shadow of Atlantis","Starlight Run",
  "Quantum Heist","Frozen Horizon","The Paper Giant",
  "Crimson Orbit","Glass Kingdom","Midnight Engine",
  "Aurora Protocol","Skybound","Lost in Marble",
  "Digital Wolves","The Silent Metro","Golden Circuit",
  "Parallel Summer","Nova Street","Forgotten Signal",
  "The Clockmaker","Phantom Signal","Blue Orbit",
  "Hollow Lights","Beyond the Static"
];

/* ===================== RENDER ===================== */
const ui=document.getElementById("ui");

function render(){
  if(state.step===0) return intro();
  if(state.step===1) return soundCheck();
  if(state.step===2) return soundAnswer();
  if(state.step>=3 && state.step<=7) return personalInfo();
  if(state.step===8) return movieBatch();
  if(state.step===9) return tableRating();
  finish();
}

/* ===================== SCREENS ===================== */
function intro(){
  ui.innerHTML=`
    <h2>Welcome</h2>
    <p>The first few questions collect personal information and are not part of the survey.</p>
    <button onclick="next()">Continue</button>
  `;
}

function soundCheck(){
  const sounds=["Birds","Wolf","Traffic"];
  state.soundHeard=sounds[Math.floor(Math.random()*sounds.length)];
  save();
  ui.innerHTML=`
    <h3>Please listen carefully</h3>
    <button id="play">â–¶ Play Sound</button>
    <button id="cont" disabled>Continue</button>
  `;
  let played=false;
  play.onclick=()=>{
    if(played) return;
    played=true;
    playSound(state.soundHeard,()=>cont.disabled=false);
  };
  cont.onclick=next;
}

function soundAnswer(){
  ui.innerHTML=`
    <h3>What did you hear?</h3>
    <div class="row">
      ${["Birds","Wolf","Traffic"].map(o=>`<button onclick="pickSound('${o}')">${o}</button>`).join("")}
    </div>
  `;
}
function pickSound(v){
  if(v!==state.soundHeard) return disqualify();
  next();
}

const infoQuestions=[
  {q:"What is your gender?",opts:["Man","Woman"]},
  {q:"What is your age?",opts:["-18","20-30","30-40","40-50","50-60","60-70","+70"]},
  {q:"What is your ZIP code?",text:true},
  {q:"What is your marital status?",opts:["Single","Divorced","Family"]},
  {q:"Did you buy a car over 5 years?",opts:["Yes","No"],kickOn:"No"}
];

function personalInfo(){
  const i=state.step-3;
  const q=infoQuestions[i];
  let html=`<h3>${q.q}</h3>`;
  if(q.opts){
    html+=`<div class="row">${q.opts.map(o=>`<button onclick="pickInfo('${o}')">${o}</button>`).join("")}</div>`;
  } else {
    html+=`<input id="txt"><button onclick="next()">Continue</button>`;
  }
  ui.innerHTML=html;
}
function pickInfo(v){
  const q=infoQuestions[state.step-3];
  if(q.kickOn && v===q.kickOn) return disqualify();
  next();
}

/* ===================== MOVIE BATCH ===================== */
function movieBatch(){
  if(state.movieIndex>=30){
    next();
    return;
  }
  const m=movies[state.movieIndex];
  ui.innerHTML=`
    <div class="badge">${state.movieIndex+1}/30</div>
    <h3 id="movie">${m}</h3>
    <div class="row">
      ${["Extremely good","Particularly good","More or less","Particularly bad","Extremely bad"]
        .map(o=>`<button onclick="rateMovie()">${o}</button>`).join("")}
    </div>
  `;
}
function rateMovie(){
  const el=document.getElementById("movie");
  el.classList.add("fade");
  setTimeout(()=>{
    state.movieIndex++;
    save();
    movieBatch();
  },2500);
}

/* ===================== TABLE RATING ===================== */
const carModels=["GoldCar","Pro%","Sixt","Ford"];
function tableRating(){
  let rows=carModels.map(m=>`
    <tr>
      <th>${m}</th>
      ${[1,2,3,4,5].map(n=>`
        <td class="${state.tableRatings[m]===n?"selected":""}"
            onclick="rateTable('${m}',${n})">${n}</td>`).join("")}
    </tr>
  `).join("");

  ui.innerHTML=`
    <h3>Rate these car models</h3>
    <table>
      <tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
      ${rows}
    </table>
    <button ${Object.keys(state.tableRatings).length<carModels.length?"disabled":""}
      onclick="next()">Continue</button>
  `;
}
function rateTable(m,n){
  state.tableRatings[m]=n;
  save();
  tableRating();
}

/* ===================== FLOW ===================== */
function next(){
  state.coins++;
  state.step++;
  save();
  render();
}
function disqualify(){
  ui.innerHTML=`<h1>Disqualified</h1><button onclick="localStorage.clear();location.reload()">Restart</button>`;
}
function finish(){
  ui.innerHTML=`
    <h1>Survey Section Complete</h1>
    <p>You may now continue.</p>
  `;
}
/* ===================== START ===================== */
render();
</script>
</body>
</html>
<script>
/* ===================== TRICK SYSTEM ===================== */
state.trickChance ??= 5;
state.inTrick ??= false;

function maybeTrick(){
  if(Math.random()*100 < state.trickChance){
    state.inTrick = true;
    state.trickType = pickTrick();
    renderTrick();
    return true;
  }
  state.trickChance = Math.min(100, state.trickChance + 1);
  return false;
}

function pickTrick(){
  const r=Math.random();
  if(r<0.25) return "letter";
  if(r<0.5) return "image";
  if(r<0.75) return "slider";
  return "clicker";
}

/* Hook trick check into flow */
const oldNext = next;
next = function(){
  state.coins++;
  if(!state.inTrick && maybeTrick()) return;
  state.step++;
  save();
  render();
};

/* ===================== TRICK RENDER ===================== */
function renderTrick(){
  if(state.trickType==="letter") return letterTrick();
  if(state.trickType==="image") return imageTrick();
  if(state.trickType==="slider") return sliderTrick();
  clickerTrick();
}

function passTrick(){
  state.inTrick=false;
  state.trickChance = Math.min(100, state.trickChance + 1);
  save();
  render();
}

/* ===== Letter ===== */
function letterTrick(){
  ui.innerHTML=`
    <h3>Please select <b>D</b></h3>
    <div class="row">
      ${["A","B","C","D"].map(l=>`<button onclick="letterPick('${l}')">${l}</button>`).join("")}
    </div>
  `;
}
function letterPick(l){ l==="D"?passTrick():disqualify(); }

/* ===== Image ===== */
function imageTrick(){
  ui.innerHTML=`
    <h3>What is this?</h3>
    <img src="tomato.png" style="max-width:200px">
    <div class="row">
      ${["Corn","Tomato","Egg","Avocado"].map(o=>`<button onclick="imagePick('${o}')">${o}</button>`).join("")}
    </div>
  `;
}
function imagePick(o){ o==="Tomato"?passTrick():disqualify(); }

/* ===== Slider ===== */
function sliderTrick(){
  const target=Math.floor(Math.random()*10)+1;
  state.sliderTarget=target;
  ui.innerHTML=`
    <h3>Slide to ${target}</h3>
    <h2 id="sv">5</h2>
    <input type="range" min="1" max="10" value="5"
      oninput="sv.innerText=this.value">
    <button onclick="checkSlider()">Submit</button>
  `;
}
function checkSlider(){
  document.querySelector("input").value==state.sliderTarget
    ?passTrick():disqualify();
}

/* ===================== CLICKER GAME ===================== */
const C = state.clicker ??= {
  pts:0, target:0,
  ppc:1, pps:0,
  crit:0.1, multi:2,
  lastClick:0, clicks:[]
};

function clickerTrick(){
  if(!C.target) C.target = Math.floor(Math.random()*901)+100;
  renderClicker();
}

function renderClicker(){
  ui.innerHTML=`
    <h3>Verification Clicker</h3>
    <h2 id="pts">${fmt(C.pts)} / ${fmt(C.target)}</h2>

    <div class="progress"><div id="bar"></div></div>

    <p>
      PPC: ${C.ppc} |
      PPS: ${C.pps} |
      CPS: <span id="cps">0</span><br>
      Crit: ${C.crit.toFixed(1)}% |
      Multi: x${C.multi.toFixed(1)}
    </p>

    <button id="clickBtn" style="font-size:22px;padding:18px 28px">
      CLICK
    </button>

    <div class="row">
      <button onclick="upPPC()">+1 PPC</button>
      <button onclick="upPPS()">+1 PPS (50)</button>
      <button onclick="upCrit()">+1% Crit (5000)</button>
      <button onclick="upMulti()">+0.1 Multi (1000)</button>
    </div>

    <button id="cont" style="display:none" onclick="passClicker()">Continue</button>
  `;

  updateBar();
  document.getElementById("clickBtn").onclick = doClick;
}

/* ===== Click logic ===== */
function doClick(e){
  const now=Date.now();
  C.clicks=C.clicks.filter(t=>now-t<1000);
  C.clicks.push(now);

  document.getElementById("cps").innerText=C.clicks.length;
  if(C.clicks.length>=15) return disqualify();

  let gain=C.ppc;
  let critHit=Math.random()*100<C.crit;
  if(critHit) gain=Math.floor(gain*C.multi);

  C.pts+=gain;
  spawnFloat(e, gain, critHit);
  updateBar();
  save();
}

setInterval(()=>{
  if(C.pps>0){
    C.pts+=C.pps;
    updateBar();
  }
},1000);

/* ===== Floating text ===== */
function spawnFloat(e,amt,crit){
  const d=document.createElement("div");
  d.textContent = crit?`CRIT!!! +${amt}`:`+${amt}`;
  d.style.position="fixed";
  const r=e.target.getBoundingClientRect();
  d.style.left=r.left+r.width/2+"px";
  d.style.top=r.top+"px";
  d.style.fontSize=crit?"28px":"22px";
  d.style.color=crit?"red":"white";
  d.style.pointerEvents="none";
  d.style.transition="all 1s ease";
  document.body.appendChild(d);
  requestAnimationFrame(()=>{
    d.style.transform="translateY(-60px)";
    d.style.opacity="0";
  });
  setTimeout(()=>d.remove(),1000);
}

/* ===== Bar ===== */
function updateBar(){
  const b=document.getElementById("bar");
  if(!b) return;
  b.style.width=Math.min(100,(C.pts/C.target)*100)+"%";
  document.getElementById("pts").innerText=
    `${fmt(C.pts)} / ${fmt(C.target)}`;
  if(C.pts>=C.target)
    document.getElementById("cont").style.display="block";
}

/* ===== Continue ===== */
function passClicker(){
  C.target=0;
  state.inTrick=false;
  save();
  render();
}

/* ===== Upgrades ===== */
function upPPC(){ C.ppc++; save(); renderClicker(); }
function upPPS(){ if(C.pts<50) return; C.pts-=50; C.pps++; save(); renderClicker(); }
function upCrit(){
  if(C.crit>=10||C.pts<5000) return;
  C.pts-=5000; C.crit+=1; save(); renderClicker();
}
function upMulti(){
  if(C.multi>=5||C.pts<1000) return;
  C.pts-=1000; C.multi+=0.1; save(); renderClicker();
}

/* ===== Utils ===== */
function fmt(n){
  if(n>=1e6) return (n/1e6).toFixed(2)+"M";
  if(n>=1e3) return (n/1e3).toFixed(1)+"K";
  return Math.floor(n);
}
</script>
