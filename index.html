<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game of Surveys</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#0f1220;--card:#161a2e;--accent:#7cf3c0;--danger:#ff6b6b;--text:#e9ecff
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:system-ui,Segoe UI,Arial;overflow:hidden
}
canvas{position:fixed;inset:0;z-index:-1}
#ui{position:fixed;inset:0;display:flex;justify-content:center}
.panel{
  margin-top:40px;width:95%;max-width:760px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(10px);
  border-radius:20px;padding:24px
}
.top{display:flex;justify-content:space-between}
.badge{background:#22286b;padding:6px 12px;border-radius:99px;font-size:13px}
.progress{height:10px;background:#22286b;border-radius:99px;overflow:hidden;margin:10px 0}
.progress div{height:100%;background:var(--accent);transition:.2s}
textarea{
  width:100%;min-height:110px;background:#0e1230;color:var(--text);
  border-radius:12px;padding:12px
}
button{
  background:linear-gradient(#8af3c8,#57d6a1);
  border:none;border-radius:12px;padding:12px 18px;
  font-weight:800;cursor:pointer;margin:6px
}
.big{font-size:30px;padding:26px 60px}
.money{font-size:36px;color:var(--accent);text-align:center}

.float{
  position:absolute;
  pointer-events:none;
  font-weight:900;
  animation:floatUp 1.2s ease-out forwards;
  text-shadow:0 0 12px rgba(255,255,255,.5)
}
.float.normal{font-size:38px;color:white}
.float.crit{font-size:58px;color:#ff3b3b}

@keyframes floatUp{
  from{transform:translateY(0) scale(1);opacity:1}
  to{transform:translateY(-90px) scale(1.2);opacity:0}
}
.shop{margin-top:12px;border-top:1px solid rgba(255,255,255,.15);padding-top:12px}
.center{text-align:center}
</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="ui"></div>

<script>
/* ================= HELPERS ================= */
const fmt=n=>{
  if(n>=1e9)return(n/1e9).toFixed(2)+"B";
  if(n>=1e6)return(n/1e6).toFixed(2)+"M";
  if(n>=1e3)return(n/1e3).toFixed(1)+"K";
  return Math.floor(n)
};
const ui=document.getElementById("ui");
const panel=h=>ui.innerHTML=`<div class=panel>${h}</div>`;

/* ================= PARTICLES ================= */
const c=document.getElementById("bg"),ctx=c.getContext("2d");
let W,H,particles=[];
function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
addEventListener("resize",resize);resize();
for(let i=0;i<140;i++)particles.push({
  x:Math.random()*W,y:Math.random()*H,
  vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,r:Math.random()*2+.5
});
(function loop(){
  ctx.clearRect(0,0,W,H);
  particles.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;
    if(p.x<0||p.x>W)p.vx*=-1;
    if(p.y<0||p.y>H)p.vy*=-1;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle="rgba(124,243,192,.35)";ctx.fill();
  });
  requestAnimationFrame(loop)
})();

/* ================= SURVEY ================= */
const QUESTIONS=[...Array(20)].map((_,i)=>`Survey question ${i+1}`);
let S=JSON.parse(localStorage.getItem("save"))||{q:0,trick:5};
function save(){localStorage.setItem("save",JSON.stringify(S))}

function renderSurvey(){
  if(S.q>=20)return finish();
  panel(`
    <div class=top>
      <div class=badge>Question ${S.q+1}/20</div>
      <div class=badge>Trick ${S.trick}%</div>
    </div>
    <div class=progress><div style="width:${S.q/20*100}%"></div></div>
    <p>${QUESTIONS[S.q]}</p>
    <textarea id=ans></textarea>
    <button onclick=submitQ()>Continue</button>
  `)
}
function submitQ(){
  if(!document.getElementById("ans").value.trim())return;
  S.q++;S.trick=Math.min(100,S.trick+1);save();
  Math.random()*100<S.trick?startClicker():renderSurvey()
}

/* ================= CLICKER ================= */
let C={
  pts:0,ppc:1,
  crit:.001,critM:2,
  ppcCost:100,critCost:5000,critMCost:1000
};

function startClicker(){renderClicker()}

function renderClicker(){
  panel(`
    <h2 class=center>${fmt(C.pts)} pts</h2>
    <div class=progress><div style="width:${Math.min(100,C.pts/1e6*100)}%"></div></div>
    <div class=center>
      <button id=clickBtn class="big">CLICK</button>
    </div>
    <p class=center>PPC: ${C.ppc}</p>
    <p class=center>Crit ${(C.crit*100).toFixed(2)}% | x${C.critM.toFixed(1)}</p>
    <div class=shop center>
      <button onclick=buyPPC()>+1 PPC (${fmt(C.ppcCost)})</button>
      <button onclick=buyCrit()>+Crit (${fmt(C.critCost)})</button>
      <button onclick=buyCritM()>+Crit Multi (${fmt(C.critMCost)})</button>
    </div>
    ${C.pts>=1e6?'<button onclick=renderSurvey()>Continue</button>':''}
  `);

  document.getElementById("clickBtn").onclick=click;
}

function spawnFloat(text,isCrit,btn){
  const r=btn.getBoundingClientRect();
  const d=document.createElement("div");
  d.className="float "+(isCrit?"crit":"normal");
  d.textContent=text;
  d.style.left=r.left+r.width/2+"px";
  d.style.top=r.top+"px";
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),1200)
}

function click(){
  const btn=document.getElementById("clickBtn");
  let gain=C.ppc,isCrit=false;
  if(Math.random()<C.crit){
    gain*=C.critM;isCrit=true
  }
  C.pts+=gain;
  spawnFloat((isCrit?"CRIT!!! +":"+")+fmt(gain),isCrit,btn);
  requestAnimationFrame(renderClicker);
}

function buyPPC(){if(C.pts>=C.ppcCost){C.pts-=C.ppcCost;C.ppc++;C.ppcCost*=1.1;renderClicker()}}
function buyCrit(){if(C.pts>=C.critCost&&C.crit<.1){C.pts-=C.critCost;C.crit=Math.min(.1,C.crit+.01);C.critCost*=1.2;renderClicker()}}
function buyCritM(){if(C.pts>=C.critMCost&&C.critM<5){C.pts-=C.critMCost;C.critM=Math.min(5,C.critM+.1);C.critMCost*=1.4;renderClicker()}}

/* ================= END ================= */
function finish(){panel(`<h1 class=center>ðŸŽ‰ Done!</h1>`)}
renderSurvey();
</script>
</body>
</html>
