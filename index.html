<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body{
  font-family:Arial, sans-serif;
  margin:0;
  background:#fff;
}
#top{
  display:flex;
  justify-content:space-between;
  padding:15px;
}
#progressText{font-size:18px}
#progressOuter{
  width:320px;height:18px;
  background:#ddd;border-radius:10px;
}
#progressInner{
  height:100%;width:0%;
  background:#4caf50;border-radius:10px;
}
#container{
  text-align:center;
  margin-top:60px;
}
.option{margin:8px}
button{padding:10px 20px;font-size:16px;margin:10px}
textarea{width:320px;height:80px}
input[type=range]{width:300px}
img{max-width:200px;margin:15px}
.small{font-size:14px;color:#555}
</style>
</head>

<body>

<div id="top">
  <div>
    <div id="progressText"></div>
    <div id="progressOuter"><div id="progressInner"></div></div>
    <div class="small" id="growthInfo"></div>
  </div>
  <div id="trickInfo"></div>
</div>

<div id="container"></div>

<script>
/* ================= STATE ================= */
let level = 0;
let step = 0;
let trickChance = 2; // persistent
let clickerScore = 0;
let currentQuestion = null;

/* ================= GROWTH RATE ================= */
function getGrowthRate(){
  if(level === 0) return 0;
  if(level === 1) return 0.1;
  if(level === 2) return 0.33;
  if(level === 3) return 1;
  if(level >= 4) return 5;
  return 0;
}

/* ================= SAVE / LOAD ================= */
function save(){
  localStorage.setItem("surveySave",
    JSON.stringify({level,step,trickChance,clickerScore})
  );
}
function load(){
  const d = localStorage.getItem("surveySave");
  if(!d) return false;
  try{
    const s = JSON.parse(d);
    level = s.level ?? 0;
    step = s.step ?? 0;
    trickChance = s.trickChance ?? 2;
    clickerScore = s.clickerScore ?? 0;
    return true;
  }catch{return false;}
}
function resetAll(){
  localStorage.clear();
  level=0;step=0;trickChance=2;clickerScore=0;
  render();
}

/* ================= QUESTIONS ================= */
const level1Questions=[
 "What motivates you to succeed?",
 "How do you handle stress?",
 "What keeps you disciplined?",
 "How do you recover from failure?",
 "What makes a task rewarding?",
 "How do you stay focused?",
 "What inspires improvement?",
 "Do you prefer routine or variety?",
 "How adaptable are you?",
 "Was it hard to achieve your goals?"
];

const level2Questions=[
 "Describe a difficult challenge you faced.",
 "How do you manage time effectively?",
 "What helps you stay productive?",
 "How do you handle pressure?",
 "What distracts you the most?",
 "How do you stay organized?",
 "What improves your performance?",
 "How do you overcome frustration?",
 "How do you balance work and rest?",
 "What habits help you succeed?"
];

/* ================= QUESTION GENERATOR ================= */
function generateQuestion(){
  if(level>=1 && Math.random()*100 < trickChance){

    if(Math.random()<0.10){
      return {type:"clicker"};
    }

    if(Math.random()<0.20){
      return {
        type:"image",
        text:"What is shown in the image?",
        options:["Corn","Tomato","Egg","Avocado"],
        correct:"Tomato"
      };
    }

    const letters=["A","B","C","D"];
    const correct=letters[Math.floor(Math.random()*4)];
    return {
      type:"letter",
      text:`This question is different. Please select "${correct}".`,
      options:letters,
      correct
    };
  }

  const list = level===1 ? level1Questions : level2Questions;
  const text = list[step];
  if(!text) return null;

  if(text.includes("hard")){
    return {type:"slider",text,min:1,max:10};
  }
  if(text.startsWith("Describe")){
    return {type:"text",text};
  }
  return {type:"radio",text,options:["Yes","No"]};
}

/* ================= RENDER ================= */
function render(){
  const c=document.getElementById("container");
  const p=document.getElementById("progressText");
  const bar=document.getElementById("progressInner");
  const trick=document.getElementById("trickInfo");
  const growth=document.getElementById("growthInfo");

  growth.textContent = `Growth Rate: +${getGrowthRate()}% per question`;

  if(level===0){
    c.innerHTML=`
      <h2>Hello!</h2>
      <p>This survey will take approximately 7 minutes.</p>
      <button onclick="level=1;step=0;render()">Start</button>
      <br><button onclick="load()?render():alert('No save found')">Resume</button>
    `;
    p.textContent="";
    trick.textContent="";
    bar.style.width="0%";
    return;
  }

  const total = level===1 ? level1Questions.length : level2Questions.length;
  p.textContent=`${step}/${total}`;
  bar.style.width=(step/total*100)+"%";
  trick.textContent=`Trick Chance: ${trickChance.toFixed(2)}%`;

  currentQuestion = generateQuestion();

  if(!currentQuestion){
    level++;
    step=0;
    render();
    return;
  }

  if(currentQuestion.type==="clicker"){
    c.innerHTML=`
      <h2>Verification Challenge</h2>
      <p>Reach 1,000,000 points</p>
      <h3>${clickerScore.toLocaleString()}</h3>
      <button onclick="clicker()">Click Me</button>
      ${clickerScore>=1000000?'<br><button onclick="finish()">Continue Survey</button>':''}
    `;
    save();
    return;
  }

  if(currentQuestion.type==="image" || currentQuestion.type==="letter"){
    c.innerHTML=`
      <h2>${currentQuestion.text}</h2>
      ${currentQuestion.type==="image"?'<img src="tomato.png">':""}
      ${currentQuestion.options.map(o=>`
        <div class="option">
          <input type="radio" name="a" value="${o}"> ${o}
        </div>`).join("")}
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  if(currentQuestion.type==="slider"){
    c.innerHTML=`
      <h2>${currentQuestion.text}</h2>
      <input type="range" id="s" min="1" max="10">
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  if(currentQuestion.type==="text"){
    c.innerHTML=`
      <h2>${currentQuestion.text}</h2>
      <textarea id="t"></textarea>
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  c.innerHTML=`
    <h2>${currentQuestion.text}</h2>
    ${currentQuestion.options.map(o=>`
      <div class="option">
        <input type="radio" name="a" value="${o}"> ${o}
      </div>`).join("")}
    <button onclick="submit()">Continue</button>
  `;
}

/* ================= LOGIC ================= */
function submit(){
  if(currentQuestion.type==="letter" || currentQuestion.type==="image"){
    const v=document.querySelector("input[name=a]:checked");
    if(!v || v.value!==currentQuestion.correct){
      resetAll(); alert("Disqualified");
      return;
    }
  }

  if(currentQuestion.type==="text"){
    const t=document.getElementById("t").value.trim();
    if(t.split(/\s+/).length<5){
      resetAll(); alert("Invalid answer");
      return;
    }
  }

  step++;
  trickChance = Math.min(trickChance + getGrowthRate(), 100);
  save();
  render();
}

function clicker(){
  clickerScore += 1;
  save();
  render();
}

function finish(){
  clickerScore = 0;
  step++;
  save();
  render();
}

render();
</script>
</body>
</html>
