<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: white;
}

#topLeft {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 16px;
}

#topRight {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 16px;
}

#progress {
  text-align: center;
  font-size: 32px;
  margin-top: 40px;
}

#container {
  max-width: 600px;
  margin: 120px auto;
  text-align: center;
}

button {
  margin-top: 20px;
  padding: 10px 25px;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="topLeft"></div>
<div id="topRight"></div>
<div id="progress"></div>

<div id="container"></div>

<script>
/* =====================
   GLOBAL STATE
===================== */
let level = 0;
let step = 0;
let trickChance = 2.0;

/* =====================
   UTILITIES
===================== */
function save() {
  localStorage.setItem("surveySave", JSON.stringify({ level, step, trickChance }));
}

function loadSave() {
  const data = JSON.parse(localStorage.getItem("surveySave"));
  if (data) {
    level = data.level;
    step = data.step;
    trickChance = data.trickChance;
  }
}

function disqualify(msg) {
  document.body.innerHTML = `<h1 style="text-align:center;margin-top:100px;">${msg}</h1>`;
  localStorage.clear();
}

/* =====================
   LEVEL DEFINITIONS
===================== */

// LEVEL 0 (QUALIFIER)
const level0 = [
  { type:"radio", text:"What is your gender?", options:["Man","Woman"] },
  { type:"radio", text:"How old are you?", options:["Under 18","18-24","25-34","35-44","45-56","57-70","Over 70"] },
  { type:"radio", text:"What is your job?", options:["Engineer","Firefighter","College"] }
];

// LEVEL 1 (NORMAL SURVEY – 20)
const level1 = [
  { type:"text", text:"What motivates you to succeed?" },
  { type:"slider", text:"How difficult was it to achieve your goals?" },
  { type:"radio", text:"Do you enjoy challenges?", options:["Yes","No","Sometimes","Not sure"] }
];

// LEVEL 2 (MIXING – 40)
const level2 = [
  { type:"text", text:"Describe a difficult decision you made." },
  { type:"slider", text:"How stressful was it? (1–10)" },
  { type:"radio", text:"Do you prefer structure?", options:["Yes","No","Sometimes","Unsure"] }
];

/* =====================
   RENDER
===================== */
function render() {
  const container = document.getElementById("container");
  container.innerHTML = "";

  document.getElementById("topLeft").innerText =
    level === 0 ? "Level 0: Qualification"
    : level === 1 ? "Level 1: Survey"
    : "Level 2: Mixing";

  document.getElementById("topRight").innerText =
    level === 0 ? ""
    : `Trick Question Chance: ${trickChance.toFixed(2)}%`;

  let questions =
    level === 0 ? level0 :
    level === 1 ? level1 :
    level2;

  let total =
    level === 0 ? questions.length :
    level === 1 ? 20 :
    40;

  document.getElementById("progress").innerText =
    level === 0 ? "" : `${step}/${total}`;

  // Greeting screens
  if (step === 0) {
    const greet = document.createElement("p");
    greet.innerText =
      level === 0
        ? "Hello, this survey will take approximately 2.5 minutes."
        : level === 1
        ? "Hello, this survey will take approximately 7 minutes."
        : "Hi, this survey will take you approximately 15min!";
    container.appendChild(greet);
    addContinue();
    return;
  }

  const q = questions[(step - 1) % questions.length];
  const title = document.createElement("h2");
  title.innerText = q.text;
  container.appendChild(title);

  if (q.type === "radio") {
    q.options.forEach(opt => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="radio" name="ans" value="${opt}"> ${opt}`;
      container.appendChild(label);
      container.appendChild(document.createElement("br"));
    });
  }

  if (q.type === "text") {
    container.innerHTML += `<textarea rows="4" cols="40"></textarea>`;
  }

  if (q.type === "slider") {
    container.innerHTML += `<input type="range" min="1" max="10">`;
  }

  addContinue();
}

/* =====================
   CONTINUE
===================== */
function addContinue() {
  const btn = document.createElement("button");
  btn.innerText = "Continue";
  btn.onclick = next;
  document.getElementById("container").appendChild(btn);
}

function next() {
  step++;

  // LEVEL TRANSITIONS
  if (level === 0 && step > level0.length) {
    level = 1;
    step = 0;
    trickChance = 2.0;
  }

  if (level === 1 && step > 20) {
    level = 2;
    step = 0;
    trickChance = 0.0;
  }

  if (level >= 1) {
    // Trick chance scaling
    if (level === 1 && trickChance < 15) trickChance += 0.01;
    if (level === 2) trickChance += 0.1;
  }

  save();
  render();
}

/* =====================
   START GAME
===================== */
loadSave();
render();
</script>

</body>
</html>
