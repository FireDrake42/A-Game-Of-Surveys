<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey + Clicker Game</title>
<style>
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#0b1020;
  color:white;
}
#app{
  max-width:900px;
  margin:auto;
  padding:20px;
}
button{
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.primary{background:#4f7cff;color:white}
.secondary{background:#333;color:white}
.row{display:flex;gap:10px;flex-wrap:wrap}
.progress{
  width:100%;height:16px;background:#222;border-radius:10px;overflow:hidden
}
.progress > div{
  height:100%;background:#4f7cff;width:0%
}
#clickBtn{
  width:220px;height:220px;
  border-radius:50%;
  font-size:28px;
  margin:20px auto;
  display:block;
}
.float{
  position:absolute;
  pointer-events:none;
  font-size:26px;
  animation:floatUp 1s forwards;
}
@keyframes floatUp{
  from{opacity:1;transform:translateY(0)}
  to{opacity:0;transform:translateY(-60px)}
}
.red{color:#ff4f4f}
.white{color:white}
.topLeft{
  position:fixed;top:10px;left:10px;font-weight:bold
}
</style>
</head>

<body>
<div class="topLeft" id="coinsUI">ðŸª™ Coins: 0</div>
<div id="app"></div>

<script>
/* ================= STATE ================= */
let state = JSON.parse(localStorage.getItem("surveyGame")) || {
  step:0,
  coins:0,
  trickChance:5,
  points:0,
  ppc:1,
  pps:0,
  critChance:0.1,
  critMulti:2,
  mode:"survey"
};

const questions = [
  {q:"Sound check: Click play and listen.",type:"sound"},
  {q:"What did you hear?",type:"choice",o:["Birds","Wolf","Traffic"]},
  {q:"What is your gender?",type:"choice",o:["Man","Woman"]},
  {q:"What is your age?",type:"choice",o:["-18","20-30","30-40","40-50","50+"]},
  {q:"Zip code?",type:"input"},
  {q:"Did you buy a car in last 5 years?",type:"choice",o:["Yes","No"],disqualify:"No"},
];

while(questions.length < 20){
  questions.push({q:"Describe a recent purchase experience.",type:"input"});
}

/* ================= UTILS ================= */
const $ = id => document.getElementById(id);
function save(){ localStorage.setItem("surveyGame",JSON.stringify(state)); }
function fmt(n){
  if(n>=1e6) return (n/1e6).toFixed(2)+"M";
  if(n>=1e3) return (n/1e3).toFixed(1)+"K";
  return Math.floor(n);
}

/* ================= SURVEY ================= */
function renderSurvey(){
  $("coinsUI").textContent = "ðŸª™ Coins: "+state.coins;
  const q = questions[state.step];
  let html = `<h2>Question ${state.step+1}/20</h2>
  <p>${q.q}</p>
  <p>Trick Chance: ${state.trickChance.toFixed(1)}%</p>`;

  if(q.type==="input"){
    html+=`<input id="ans" style="width:100%;padding:10px">`;
  }
  if(q.type==="choice"){
    q.o.forEach(o=>{
      html+=`<button onclick="answer('${o}')">${o}</button> `;
    });
  }
  if(q.type==="sound"){
    html+=`<audio id="audio" src="https://www.soundjay.com/nature/birds-1.mp3"></audio>
    <button onclick="playSound()">â–¶ Play</button>
    <button id="cont" disabled onclick="next()">Continue</button>`;
  }
  if(q.type==="input"){
    html+=`<br><br><button class="primary" onclick="answer()">Continue</button>`;
  }

  $("app").innerHTML = html;
}

function playSound(){
  const a = $("audio");
  a.play();
  a.onended = ()=> $("cont").disabled=false;
}

function answer(v){
  const q = questions[state.step];
  if(q.disqualify && v===q.disqualify){
    $("app").innerHTML = `<h2>Disqualified</h2>`;
    return;
  }
  state.coins++;
  state.step++;
  state.trickChance+=1;
  save();
  if(state.step>=20){
    endSurvey();
  }else{
    renderSurvey();
  }
}

function next(){ answer(); }

function endSurvey(){
  $("app").innerHTML = `
    <h2>Survey Section Complete</h2>
    <button class="primary" onclick="startClicker()">Continue</button>
    <button class="secondary" onclick="restartSurvey()">Start Over Survey</button>
  `;
}

/* ================= CLICKER ================= */
let cps=0,lastClick=0;

function startClicker(){
  state.mode="clicker";
  renderClicker();
  setInterval(()=>{
    state.points+=state.pps;
    renderClicker();
  },1000);
}

function renderClicker(){
  $("coinsUI").textContent = "ðŸª™ Coins: "+state.coins;
  let pct = Math.min(100,state.points/1000*100);
  $("app").innerHTML = `
  <h2>Clicker Verification</h2>
  <p>Points: ${fmt(state.points)}</p>
  <p>PPC: ${state.ppc} | PPS: ${state.pps}</p>
  <p>Crit Chance: ${state.critChance.toFixed(2)}% | Crit x${state.critMulti}</p>
  <div class="progress"><div style="width:${pct}%"></div></div>
  <button id="clickBtn" class="primary" onclick="click(event)">CLICK</button>
  <div class="row">
    <button onclick="buyPPC()">+1 PPC (100)</button>
    <button onclick="buyPPS()">+1 PPS (50)</button>
    <button onclick="buyCrit()">+1% Crit (5000)</button>
    <button onclick="buyMulti()">+0.1 Multi (1000)</button>
  </div>
  ${state.points>=1000?`<br><button onclick="alert('Continue!')">Continue</button>`:""}
  `;
}

function click(e){
  const now=Date.now();
  if(now-lastClick<70)cps++;
  lastClick=now;

  let gain=state.ppc;
  let crit=false;
  if(Math.random()*100 < state.critChance){
    gain*=state.critMulti;
    crit=true;
  }
  state.points+=gain;
  floatText(e.clientX,e.clientY,crit?`CRIT +${gain}`:`+${gain}`,crit);
  save();
  renderClicker();
}

function floatText(x,y,t,crit){
  const d=document.createElement("div");
  d.className="float "+(crit?"red":"white");
  d.style.left=x+"px";
  d.style.top=y+"px";
  d.textContent=t;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),1000);
}

/* ================= UPGRADES ================= */
function buyPPC(){ if(state.points>=100){state.points-=100;state.ppc++;}}
function buyPPS(){ if(state.points>=50){state.points-=50;state.pps++;}}
function buyCrit(){
  if(state.points>=5000 && state.critChance<10){
    state.points-=5000;
    state.critChance=Math.min(10,state.critChance+1);
  }
}
function buyMulti(){
  if(state.points>=1000 && state.critMulti<5){
    state.points-=1000;
    state.critMulti+=0.1;
  }
}

/* ================= RESET ================= */
function restartSurvey(){
  state.step=0;
  state.trickChance=5;
  state.mode="survey";
  save();
  renderSurvey();
}

/* ================= INIT ================= */
state.mode==="survey"?renderSurvey():startClicker();
</script>
</body>
</html>
