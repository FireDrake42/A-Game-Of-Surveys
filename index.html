<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body{font-family:Arial;margin:0}
#top{display:flex;justify-content:space-between;padding:15px}
#progressText{font-size:18px}
#progressOuter{width:320px;height:18px;background:#ddd;border-radius:10px}
#progressInner{height:100%;width:0%;background:#4caf50;border-radius:10px}
#container{text-align:center;margin-top:60px}
button{padding:10px 20px;margin:8px}
textarea{width:320px;height:80px}
input[type=range]{width:300px}
img{max-width:200px}
.warning{color:red;font-weight:bold}
.small{font-size:14px}
</style>
</head>

<body>

<div id="top">
  <div>
    <div id="progressText"></div>
    <div id="progressOuter"><div id="progressInner"></div></div>
    <div class="small" id="growthInfo"></div>
  </div>
  <div id="trickInfo"></div>
</div>

<div id="container"></div>

<script>
/* ================= STATE ================= */
let level=0, step=0;
let trickChance=2;
let currentQuestion=null;
let inClicker=false;
let clickerScore=0;
let clickerPower=1;

/* ================= GROWTH ================= */
function getGrowth(){
  if(level===0) return 0;
  if(level===1) return 0.1;
  if(level===2) return 0.33;
  if(level===3) return 1;
  return 5;
}

/* ================= SAVE ================= */
function save(){
  localStorage.setItem("surveySave",JSON.stringify({
    level,step,trickChance,clickerScore,clickerPower
  }));
}
function load(){
  const d=localStorage.getItem("surveySave");
  if(!d) return false;
  Object.assign(window,JSON.parse(d));
  return true;
}
function resetAll(){
  localStorage.clear();
  level=0;step=0;trickChance=2;
  clickerScore=0;clickerPower=1;
  inClicker=false;
  render();
}

/* ================= QUESTIONS ================= */
const q1=[
 "What motivates you to succeed?",
 "How do you handle stress?",
 "What keeps you disciplined?",
 "How do you recover from failure?",
 "What makes a task rewarding?",
 "How do you stay focused?",
 "What inspires improvement?",
 "Do you prefer routine or variety?",
 "How adaptable are you?",
 "Was it hard to achieve your goals?"
];

const q2=[
 "Describe a difficult challenge you faced.",
 "How do you manage time effectively?",
 "What helps you stay productive?",
 "How do you handle pressure?",
 "What distracts you the most?",
 "How do you stay organized?",
 "What improves your performance?",
 "How do you overcome frustration?",
 "How do you balance work and rest?",
 "What habits help you succeed?"
];

/* ================= QUESTION GENERATION ================= */
function generateQuestion(){
  if(level>=1 && Math.random()*100 < trickChance){
    if(Math.random()<0.10){
      inClicker=true;
      return {type:"clicker"};
    }
    if(Math.random()<0.20){
      return {type:"image",correct:"Tomato"};
    }
    const letters=["A","B","C","D"];
    const c=letters[Math.floor(Math.random()*4)];
    return {type:"letter",correct:c};
  }

  const list=level===1?q1:q2;
  const text=list[step];
  if(!text) return null;

  if(text.includes("hard")) return {type:"slider",text};
  if(text.startsWith("Describe")) return {type:"text",text};
  return {type:"radio",text};
}

/* ================= RENDER ================= */
function render(){
  const c=document.getElementById("container");
  const p=document.getElementById("progressText");
  const bar=document.getElementById("progressInner");
  const trick=document.getElementById("trickInfo");
  const growth=document.getElementById("growthInfo");

  growth.textContent=`Growth Rate: +${getGrowth()}% per question`;

  if(level===0){
    c.innerHTML=`
      <h2>Hello!</h2>
      <p>This survey takes ~7 minutes.</p>
      <button onclick="level=1;step=0;render()">Start</button>
      <button onclick="load()?render():alert('No save')">Resume</button>
    `;
    p.textContent="";bar.style.width="0%";trick.textContent="";
    return;
  }

  const total=level===1?q1.length:q2.length;
  p.textContent=`${step}/${total}`;
  bar.style.width=(step/total*100)+"%";

  trick.innerHTML = trickChance>=50
    ? `<span class="warning">âš  Trick Chance: ${trickChance.toFixed(2)}%</span>`
    : `Trick Chance: ${trickChance.toFixed(2)}%`;

  if(inClicker){
    c.innerHTML=`
      <h2>Verification Challenge</h2>
      <h3>${clickerScore.toLocaleString()} / 1,000,000</h3>
      <button onclick="clicker()">Click Me</button>
      <br>
      <button onclick="buy(1,1000)">+1 (1,000)</button>
      <button onclick="buy(10,10000)">+10 (10,000)</button>
      <button onclick="buy(100,100000)">+100 (100,000)</button>
      ${clickerScore>=1000000?'<br><button onclick="finishClicker()">Continue</button>':''}
    `;
    save();
    return;
  }

  currentQuestion=generateQuestion();
  if(!currentQuestion){
    level++;step=0;render();return;
  }

  if(currentQuestion.type==="image"){
    c.innerHTML=`
      <h2>What is shown?</h2>
      <img src="tomato.png"><br>
      ${["Corn","Tomato","Egg","Avocado"].map(o=>`
        <div><input type="radio" name="a" value="${o}">${o}</div>`).join("")}
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  if(currentQuestion.type==="letter"){
    c.innerHTML=`
      <h2>Please select "${currentQuestion.correct}"</h2>
      ${["A","B","C","D"].map(o=>`
        <div><input type="radio" name="a" value="${o}">${o}</div>`).join("")}
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  if(currentQuestion.type==="slider"){
    c.innerHTML=`
      <h2>${currentQuestion.text}</h2>
      <input type="range" id="s" min="1" max="10">
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  if(currentQuestion.type==="text"){
    c.innerHTML=`
      <h2>${currentQuestion.text}</h2>
      <textarea id="t"></textarea>
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  c.innerHTML=`
    <h2>${currentQuestion.text}</h2>
    ${["Yes","No"].map(o=>`
      <div><input type="radio" name="a" value="${o}">${o}</div>`).join("")}
    <button onclick="submit()">Continue</button>
  `;
}

/* ================= LOGIC ================= */
function submit(){
  let isTrick = ["letter","image"].includes(currentQuestion.type);

  if(isTrick){
    const v=document.querySelector("input[name=a]:checked");
    if(!v || v.value!==currentQuestion.correct){
      alert("Disqualified");resetAll();return;
    }
  }

  if(currentQuestion.type==="text"){
    if(document.getElementById("t").value.trim().split(/\s+/).length<5){
      alert("Invalid");resetAll();return;
    }
  }

  step++;
  let g=getGrowth();
  trickChance=Math.min(trickChance + (isTrick?g/100:g),100);
  save();
  render();
}

/* ================= CLICKER ================= */
function clicker(){
  clickerScore+=clickerPower;
  save();render();
}
function buy(p,c){
  if(clickerScore<c) return;
  clickerScore-=c;
  clickerPower+=p;
  save();render();
}
function finishClicker(){
  inClicker=false;
  clickerScore=0;
  step++;
  save();
  render();
}

render();
</script>
</body>
</html>
