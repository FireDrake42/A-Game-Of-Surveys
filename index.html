<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<style>
html,body{
  margin:0;padding:0;background:#050814;color:white;
  font-family:system-ui,sans-serif;overflow:hidden
}
#particles-js{position:fixed;width:100%;height:100%;z-index:-1}
#app{max-width:900px;margin:auto;padding:30px}

button{
  padding:14px 20px;border:none;border-radius:12px;
  font-size:16px;cursor:pointer
}
.primary{background:#4f7cff;color:white}
.secondary{background:#333;color:white}
.choice{display:block;width:100%;margin:8px 0}

.progress{height:10px;background:#222;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:#4f7cff}

.topLeft{
  position:fixed;top:10px;left:10px;font-weight:bold
}

.card{
  background:#0b1024;
  padding:16px;
  border-radius:16px;
  margin:14px 0
}

.reward{
  font-size:42px;
  font-weight:800;
  color:#3cff87;
  text-align:center;
  margin:20px 0
}

.stars span{
  font-size:26px;
  cursor:pointer;
  color:#444
}
.stars span.active{color:gold}
</style>
</head>

<body>

<div id="particles-js"></div>

<div class="topLeft">
  <div id="coinsUI">ü™ô Coins: 0</div>
  <div id="trickUI">üé≤ Trick Chance: 5%</div>
</div>

<div id="app"></div>

<script>
/* PARTICLES */
particlesJS("particles-js",{
  particles:{number:{value:60},color:{value:"#4f7cff"},size:{value:2},move:{enable:true,speed:1}},
  interactivity:{events:{onhover:{enable:true,mode:"repulse"}}}
});

/* STATE */
let state = JSON.parse(localStorage.getItem("surveyState")) || {
  step:0,
  coins:0,
  trickChance:5,
  inTrick:false,
  trickType:null,
  clicks:0
};

/* SURVEY */
const survey=[
  {type:"choice",q:"What is your gender?",o:["Man","Woman"]},
  {type:"choice",q:"Your age?",o:["-18","20-30","30-40","40-50","50+"]},
  {type:"input",q:"Zip Code"}
];

/* RENDER */
function render(){
  coinsUI.textContent="ü™ô Coins: "+state.coins;
  trickUI.textContent="üé≤ Trick Chance: "+state.trickChance+"%";

  if(state.inTrick) return renderTrick();

  const q=survey[state.step];
  if(!q) return endSurvey();

  let html=`<div class="progress"><div style="width:${(state.step/survey.length)*100}%"></div></div>`;

  if(q.type==="choice"){
    html+=`<h3>${q.q}</h3>`;
    q.o.forEach(o=>{
      html+=`<button class="choice primary" onclick="answer()">${o}</button>`;
    });
  }

  if(q.type==="input"){
    html+=`<h3>${q.q}</h3>
    <input id="inp" style="width:100%;padding:12px">
    <br><br><button class="primary" onclick="answer()">Continue</button>`;
  }

  app.innerHTML=html;
}

/* ANSWER */
function answer(){
  state.coins++;
  state.step++;
  if(Math.random()*100 < state.trickChance){
    state.inTrick=true;
    const r=Math.random();
    state.trickType=r<0.25?"letter":r<0.5?"image":r<0.75?"slider":"clicker";
  }
  state.trickChance=Math.min(100,state.trickChance+1);
  save();render();
}

/* TRICKS */
function renderTrick(){
  let html="";
  if(state.trickType==="letter"){
    html=`<h3>Select D</h3>
    ${["A","B","C","D"].map(l=>`<button class="choice primary" onclick="check('${l}')">${l}</button>`).join("")}`;
  }
  if(state.trickType==="image"){
    html=`<h3>What is this?</h3>
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Tomato_je.jpg" width="120"><br><br>
    ${["Tomato","Apple","Onion"].map(o=>`<button class="choice primary" onclick="check('${o}')">${o}</button>`).join("")}`;
  }
  if(state.trickType==="slider"){
    html=`<h3>Slide to 7</h3>
    <input type="range" min="1" max="10" id="s" oninput="sv.textContent=this.value">
    <div id="sv">5</div>
    <button class="primary" onclick="check()">Submit</button>`;
  }
  if(state.trickType==="clicker"){
    state.clicks=0;
    html=`<h3>Click to 300</h3>
    <h2 id="sc">0</h2>
    <button class="primary" onclick="clicker()">Click</button>`;
  }
  app.innerHTML=html;
}

function check(v){
  if(state.trickType==="letter"&&v!=="D")return fail();
  if(state.trickType==="image"&&v!=="Tomato")return fail();
  if(state.trickType==="slider"&&s.value!=7)return fail();
  state.inTrick=false;
  save();render();
}

function clicker(){
  state.clicks+=50;
  sc.textContent=state.clicks;
  if(state.clicks>=300){
    state.inTrick=false;
    save();render();
  }
}

function fail(){
  app.innerHTML=`<h2>‚ùå Disqualified</h2><button onclick="restart()">Restart</button>`;
}

/* END SURVEY */
function endSurvey(){
  app.innerHTML=`
    <div class="reward">+0.38 USD</div>

    <div class="card">
      <b>Survey Available</b><br>
      üí∞ 0.38 USD<br>
      ‚è± ~14 min<br>
      üë• 74 completed
      <div class="stars">${[1,2,3,4,5].map(i=>`<span onclick="rate(${i})">‚òÖ</span>`).join("")}</div>
    </div>

    <button class="secondary" onclick="restart()">Start Over Survey</button>
  `;
}

function rate(n){
  document.querySelectorAll(".stars span").forEach((s,i)=>{
    s.classList.toggle("active",i<n);
  });
}

/* UTILS */
function restart(){
  state.step=0;
  state.inTrick=false;
  save();render();
}
function save(){localStorage.setItem("surveyState",JSON.stringify(state))}

render();
</script>
</body>
</html>
