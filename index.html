<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: white;
}

#top {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  align-items: center;
}

#progressText {
  font-size: 18px;
  margin-bottom: 4px;
}

#progressBarOuter {
  width: 100%;
  height: 18px;
  background: #eee;
  border-radius: 10px;
  overflow: hidden;
}

#progressBarInner {
  height: 100%;
  width: 0%;
  background: #4caf50;
  transition: width 0.3s ease;
}

#trick {
  font-size: 14px;
}

#container {
  text-align: center;
  margin-top: 80px;
}

button {
  margin: 10px;
  padding: 10px 20px;
  font-size: 16px;
}

input[type=text] {
  width: 60%;
  padding: 8px;
  font-size: 16px;
}

input[type=range] {
  width: 60%;
}
</style>
</head>

<body>

<div id="top">
  <div style="width:70%">
    <div id="progressText"></div>
    <div id="progressBarOuter">
      <div id="progressBarInner"></div>
    </div>
  </div>
  <div id="trick"></div>
</div>

<div id="container"></div>

<script>
let level = 0;
let step = 0;
let trickChance = 0;
let currentQuestion = null;

/* ---------- QUESTION BANKS ---------- */

const level0 = [
  {type:"radio", text:"What is your gender?", options:["Man","Woman"]},
  {type:"radio", text:"How old are you?", options:["Under 18","18-24","25-34","35-44","45-56","57-70","60+"]},
  {type:"select", text:"What is your birth month?", options:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},
  {type:"radio", text:"What is your job?", options:["Engineer","Firefighter","College"]}
];

const level1 = [
  {type:"text", text:"What is your highest education level?"},
  {type:"text", text:"Why did you choose it? (10+ words)"},
  ...Array.from({length:18},(_,i)=>({
    type:"radio",
    text:`Opinion question ${i+3}`,
    options:["Yes","No"]
  }))
];

const level2 = Array.from({length:40}, (_,i)=>({
  type: i%3===0 ? "text" : i%3===1 ? "radio" : "slider",
  text: [
    "Describe a challenge you overcame.",
    "Do you adapt quickly?",
    "Rate your focus today.",
    "What helps you stay motivated?",
    "Do you prefer planning or improvising?"
  ][i%5],
  options:["Yes","No"],
  min:1, max:10
}));

const level4 = Array.from({length:60}, (_,i)=>({
  type: i%3===0 ? "text" : i%3===1 ? "radio" : "slider",
  text: [
    "What keeps you focused long-term?",
    "Do you feel mentally resilient?",
    "Rate your stress tolerance.",
    "How do you recover from failure?",
    "Do you prefer certainty or risk?"
  ][i%5],
  options:["Yes","No"],
  min:1, max:10
}));

/* ---------- CORE ---------- */

function save() {
  localStorage.setItem("surveySave", JSON.stringify({level,step,trickChance}));
}

function load() {
  const d = JSON.parse(localStorage.getItem("surveySave"));
  if(d){ level=d.level; step=d.step; trickChance=d.trickChance; }
}

function disqualify(msg){
  alert(msg);
  localStorage.removeItem("surveySave");
  location.reload();
}

function validText(t){
  const words = t.trim().split(/\s+/);
  return words.length >= 3 && !/^(.)\1+$/.test(t.replace(/\s/g,""));
}

function generateQuestion(){
  let base =
    level===1 ? level1 :
    level===2 ? level2 :
    level===4 ? level4 : [];

  if(level>=1){
    const roll = Math.random() * 100;
    if(roll < trickChance){
      if(Math.random() < 0.5){
        const letters=["A","B","C","D"];
        const correct=letters[Math.floor(Math.random()*4)];
        return {
          trick:true,
          type:"radio",
          text:`This is a different question. Please select "${correct}".`,
          options:letters,
          correct
        };
      } else {
        const correct=Math.floor(Math.random()*10)+1;
        return {
          trick:true,
          type:"slider",
          text:`Verification check. Please slide to ${correct}.`,
          min:1,max:10,correct
        };
      }
    }
  }
  return base[step-1];
}

function render(){
  const c=document.getElementById("container");
  c.innerHTML="";

  let total = level===1 ? 20 : level===2 ? 40 : level===4 ? 60 : 0;
  let percent = total ? Math.round((step/total)*100) : 0;

  document.getElementById("progressText").innerText =
    total ? `${percent}% Complete` : "";

  document.getElementById("progressBarInner").style.width =
    total ? percent + "%" : "0%";

  document.getElementById("trick").innerText =
    level>=1 ? `Trick Question Chance: ${trickChance.toFixed(2)}%` : "";

  if(step===0){
    c.innerHTML = `<h2>${
      level===0 ? "Hello, this survey will take approximately 2.5 minutes."
      : level===1 ? "Hello, this survey will take approximately 7 minutes."
      : level===2 ? "Hi, this survey will take approximately 15 minutes!"
      : "Welcome to the final survey. This will take approximately 25 minutes."
    }</h2>`;
    return addContinue();
  }

  if(!currentQuestion) currentQuestion = generateQuestion();
  const q=currentQuestion;

  const h=document.createElement("h2");
  h.innerText=q.text;
  c.appendChild(h);

  if(q.type==="radio"){
    q.options.forEach(o=>{
      const r=document.createElement("input");
      r.type="radio"; r.name="q"; r.value=o;
      c.appendChild(r);
      c.append(o);
      c.appendChild(document.createElement("br"));
    });
  }

  if(q.type==="text"){
    const t=document.createElement("input");
    t.type="text"; t.id="txt";
    c.appendChild(t);
  }

  if(q.type==="slider"){
    const s=document.createElement("input");
    s.type="range"; s.min=q.min; s.max=q.max; s.value=q.min; s.id="sl";
    c.appendChild(s);
  }

  addContinue();
}

function addContinue(){
  const b=document.createElement("button");
  b.innerText="Continue";
  b.onclick=next;
  document.getElementById("container").appendChild(b);
}

function next(){
  const q=currentQuestion;

  if(step>0){
    if(q.type==="radio"){
      const sel=document.querySelector("input[name=q]:checked");
      if(!sel) return alert("Select one option.");
      if(q.trick && sel.value!==q.correct) return disqualify("Verification failed.");
      if(level===0 && sel.value==="60+") return disqualify("Disqualified by age.");
    }

    if(q.type==="text"){
      if(!validText(document.getElementById("txt").value))
        return disqualify("Invalid response.");
    }

    if(q.type==="slider" && q.trick){
      if(document.getElementById("sl").value!=q.correct)
        return disqualify("Verification failed.");
    }
  }

  step++;
  currentQuestion=null;

  if(level===0 && step>level0.length){ level=1; step=0; trickChance=2; }
  else if(level===1 && step>=20){ level=2; step=0; trickChance=0.1; }
  else if(level===2 && step>=40){ level=4; step=0; trickChance=0; }
  else if(level===1) trickChance+=0.01;
  else if(level===2) trickChance+=0.25;
  else if(level===4) trickChance+=1;

  save();
  render();
}

load();
render();
</script>
</body>
</html>
