<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body{font-family:Arial;margin:0;padding:20px;background:white}
#top{display:flex;justify-content:space-between}
#progressBar{width:100%;height:14px;background:#ddd;border-radius:7px;margin:10px 0}
#progressFill{height:100%;width:0%;background:#4caf50}
.warning{color:red;font-weight:bold}
button{padding:10px 16px;font-size:16px;margin-top:10px}
textarea{width:100%;height:90px}
img{max-width:200px;margin:10px 0}
</style>
</head>

<body>

<div id="top">
  <div id="counter"></div>
  <div id="chance"></div>
</div>

<div id="progressBar"><div id="progressFill"></div></div>
<div id="container"></div>

<script>
/* ---------------- STATE ---------------- */
let state={
  level:0,
  step:0,
  trickChance:2,
  inTrick:false,
  trickData:null
};

/* ---------------- QUESTIONS ---------------- */
const questions={
  1:[
    "What does success mean to you?",
    "What motivates you to work hard?",
    "Describe a goal you achieved.",
    "How do you handle failure?",
    "What skill would you like to improve?"
  ],
  2:[
    "What inspires you creatively?",
    "How do you stay focused?",
    "What is your biggest strength?",
    "How do you manage stress?",
    "What motivates long-term goals?",
    "What helps you stay disciplined?",
    "What does teamwork mean?",
    "How do you learn best?",
    "What drives personal growth?",
    "What does responsibility mean?",
    "How do you stay organized?",
    "What is meaningful work?",
    "How do you handle setbacks?",
    "What builds resilience?",
    "What does leadership mean?",
    "What encourages innovation?",
    "How do you evaluate success?",
    "What helps decision making?",
    "What motivates improvement?",
    "What inspires learning?"
  ]
};

/* ---------------- GROWTH ---------------- */
function growthRate(){
  if(state.level===1) return 0.1;
  if(state.level===2) return 0.33;
  return 0;
}

/* ---------------- SAVE ---------------- */
function save(){localStorage.setItem("surveySave",JSON.stringify(state))}
function load(){
  const d=localStorage.getItem("surveySave");
  if(!d) return false;
  state=JSON.parse(d);return true;
}

/* ---------------- VALIDATION ---------------- */
function validText(t){
  if(!t) return false;
  const w=t.trim().split(/\s+/);
  return w.length>=5 && new Set(w).size>=3;
}

/* ---------------- RENDER ---------------- */
function render(){
  const c=document.getElementById("container");
  c.innerHTML="";

  document.getElementById("counter").innerHTML=
    state.level>0?`Level ${state.level}`:"";

  document.getElementById("chance").innerHTML=
    state.level>0?`Trick Chance: ${state.trickChance.toFixed(2)}%`:"";

  document.getElementById("chance").className=
    state.trickChance>=50?"warning":"";

  if(state.level===0){
    c.innerHTML=`
      <h2>A Game Of Surveys</h2>
      <p>This survey will take ~15 minutes.</p>
      <button onclick="startNew()">Start New</button>
      ${localStorage.getItem("surveySave")?`<button onclick="resume()">Resume</button>`:""}
    `;
    return;
  }

  if(state.inTrick){
    renderTrick();
    return;
  }

  renderQuestion();
}

/* ---------------- NORMAL QUESTIONS ---------------- */
function renderQuestion(){
  const list=questions[state.level];
  if(state.step>=list.length){nextLevel();return;}

  document.getElementById("progressFill").style.width=
    (state.step/list.length*100)+"%";

  document.getElementById("container").innerHTML=`
    <h3>${state.step+1}/${list.length}</h3>
    <p>${list[state.step]}</p>
    <textarea id="answer"></textarea>
    <button onclick="submit()">Continue</button>
  `;
}

/* ---------------- SUBMIT ---------------- */
function submit(){
  const t=document.getElementById("answer").value;
  if(!validText(t)){fail("Invalid answer");return;}

  state.step++;
  maybeTrick();
  save();
  render();
}

/* ---------------- TRICK SPAWN ---------------- */
function maybeTrick(){
  state.trickChance=Math.min(100,state.trickChance+growthRate());
  if(Math.random()*100<state.trickChance){
    state.inTrick=true;
    spawnTrick();
  }
}

/* ---------------- TRICKS ---------------- */
function spawnTrick(){
  const types=["letter","image","slider","clicker"];
  state.trickData={type:types[Math.floor(Math.random()*types.length)]};
}

function renderTrick(){
  const c=document.getElementById("container");
  const t=state.trickData.type;

  if(t==="letter"){
    c.innerHTML=`
      <p>Please select option <b>D</b></p>
      ${["A","B","C","D"].map(l=>`<button onclick="letter('${l}')">${l}</button>`).join("")}
    `;
  }

  if(t==="image"){
    c.innerHTML=`
      <p>What is shown?</p>
      <img src="tomato.png">
      ${["Corn","Tomato","Egg","Avocado"]
        .map(o=>`<button onclick="imagePick('${o}')">${o}</button>`).join("")}
    `;
  }

  if(t==="slider"){
    const n=Math.floor(Math.random()*10)+1;
    state.trickData.correct=n;
    c.innerHTML=`
      <p>Slide to <b>${n}</b></p>
      <input type="range" id="s" min="1" max="10">
      <button onclick="slider()">Submit</button>
    `;
  }

  if(t==="clicker"){
    state.trickData.score=0;
    c.innerHTML=`
      <p>Reach 50 clicks</p>
      <p id="sc">0</p>
      <button onclick="clicker()">Click Me</button>
    `;
  }
}

/* ---------------- TRICK HANDLERS ---------------- */
function letter(l){l==="D"?passTrick():fail("Wrong letter")}
function imagePick(o){o==="Tomato"?passTrick():fail("Wrong image")}
function slider(){
  const v=document.getElementById("s").value;
  v==state.trickData.correct?passTrick():fail("Wrong slide");
}
function clicker(){
  state.trickData.score++;
  document.getElementById("sc").innerText=state.trickData.score;
  if(state.trickData.score>=50) passTrick();
}

function passTrick(){
  state.inTrick=false;
  state.trickData=null;
  save();render();
}

function fail(msg){
  alert("Disqualified: "+msg);
  localStorage.removeItem("surveySave");
  state={level:0,step:0,trickChance:2};
  render();
}

/* ---------------- LEVEL ---------------- */
function nextLevel(){
  state.level++;
  state.step=0;
  save();render();
}

/* ---------------- CONTROLS ---------------- */
function startNew(){state={level:1,step:0,trickChance:2};save();render();}
function resume(){if(load())render();}

window.onload=()=>{if(!load())state.level=0;render();}
</script>
</body>
</html>
