<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

.level { position: absolute; top: 10px; left: 10px; }
.trick { position: absolute; top: 10px; right: 10px; }
.progress { font-size: 28px; margin-bottom: 20px; }

.container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.options label {
  display: block;
  margin: 8px;
  font-size: 18px;
}

textarea { width: 340px; height: 90px; }

input[type="range"] {
  width: 300px;
}

.rangeValue {
  margin-top: 10px;
  font-size: 18px;
}

button {
  margin-top: 20px;
  padding: 10px 28px;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="levelText" class="level">Level 0: stuff before surveys</div>
<div id="trickChance" class="trick"></div>

<div class="container">
  <div id="progress" class="progress"></div>
  <div id="question"></div>
  <div id="options" class="options"></div>
  <button id="continueBtn">Continue</button>
</div>

<script>
/* ===== STATE ===== */
let level = 0;
let step = 0;
let trickChance = 2.0;
let activeTrick = null;

/* ===== ELEMENTS ===== */
const qEl = document.getElementById("question");
const oEl = document.getElementById("options");
const btn = document.getElementById("continueBtn");
const lvlText = document.getElementById("levelText");
const prog = document.getElementById("progress");
const trickEl = document.getElementById("trickChance");

/* ===== QUESTIONS ===== */

const level0 = [
  { type:"msg", text:"Hello, this survey will take approximately 2.5 minutes to complete, so please answer honestly!!!" },
  { type:"radio", text:"What is your gender?", options:["Man","Woman"] },
  { type:"radio", text:"How old are you?", options:["Under 18","25-34","35-44","45-56","57-70","Over 70 years old"] },
  { type:"radio", text:"What is your job?", options:["Engineer","Firefighter","College"] }
];

const level1Greeting = {
  type:"msg",
  text:"Hello, this survey will take approximately 7 minutes to complete. Please answer carefully."
};

const level1Questions = [
  { type:"radio", text:"Do you enjoy long-term challenges?", options:["Yes","No","Sometimes","Not sure"] },
  { type:"radio", text:"How often do you set personal goals?", options:["Often","Sometimes","Rarely","Never"] },
  { type:"text", text:"What motivates you to succeed?" },
  { type:"radio", text:"Do you prefer structure or freedom?", options:["Structure","Freedom","Both","Neither"] },
  { type:"radio", text:"Do you enjoy learning new skills?", options:["Yes","No","Depends","Sometimes"] },
  { type:"radio", text:"Do deadlines stress you?", options:["Yes","No","Sometimes","Always"] },
  { type:"text10", text:"Describe a challenge you overcame (10+ words)." },
  { type:"radio", text:"Do you work better alone or in teams?", options:["Alone","Teams","Both","Neither"] },
  { type:"radio", text:"Do you consider yourself patient?", options:["Yes","No","Somewhat","Not sure"] },

  /* QUESTION 10 — SLIDER */
  { type:"slider", text:"Was it hard to achieve!?" },

  { type:"radio", text:"Do you plan ahead?", options:["Yes","No","Sometimes","Rarely"] },
  { type:"radio", text:"Do you like problem solving?", options:["Yes","No","Sometimes","Not sure"] },
  { type:"radio", text:"Do you reflect on past mistakes?", options:["Often","Sometimes","Rarely","Never"] },
  { type:"radio", text:"Do you handle pressure well?", options:["Yes","No","Depends","Not sure"] },
  { type:"radio", text:"Do you prefer stability?", options:["Yes","No","Sometimes","Not sure"] },
  { type:"radio", text:"Do you enjoy responsibility?", options:["Yes","No","Depends","Sometimes"] },
  { type:"radio", text:"Do you adapt quickly?", options:["Yes","No","Sometimes","Not sure"] },
  { type:"radio", text:"Do you seek feedback?", options:["Often","Sometimes","Rarely","Never"] },
  { type:"radio", text:"Do you trust your decisions?", options:["Yes","No","Sometimes","Not sure"] },
  { type:"radio", text:"Do you enjoy complex tasks?", options:["Yes","No","Sometimes","Not sure"] }
];

/* ===== TRICKS ===== */

const trickTexts = [
  "This is a different question people may encounter. Please select option “{X}”.",
  "Attention check: choose option “{X}” to continue.",
  "Verification question: select “{X}”."
];

function rollTrickOnce() {
  if (Math.random() * 100 >= trickChance) return null;

  // 20% slider trick, 80% letter trick
  if (Math.random() < 0.2) {
    const target = Math.floor(Math.random()*10)+1;
    return {
      type:"trickSlider",
      text:`Please slide to the number ${target} (1 to 10) to verify your eyes.`,
      correct: target
    };
  } else {
    const letters=["A","B","C","D"];
    const correct=letters[Math.floor(Math.random()*4)];
    const text=trickTexts[Math.floor(Math.random()*trickTexts.length)]
      .replace("{X}", correct);
    return { type:"trick", text, options:letters, correct };
  }
}

/* ===== CORE ===== */

function disqualify(msg){
  qEl.textContent=msg;
  oEl.innerHTML="";
  btn.style.display="none";
}

function load(){
  oEl.innerHTML="";
  btn.disabled=true;
  activeTrick=null;

  if(level===1){
    prog.textContent = step===0 ? "0/20" : `${step}/20`;
    trickEl.textContent = `Trick Question Chance: ${trickChance.toFixed(2)}%`;
  } else {
    prog.textContent="";
    trickEl.textContent="";
  }

  let q;
  if(level===0){
    q=level0[step];
  } else {
    if(step===0) q=level1Greeting;
    else {
      q=level1Questions[step-1];
      activeTrick=rollTrickOnce();
      if(activeTrick) q=activeTrick;
    }
  }

  qEl.textContent=q.text;

  if(q.type==="msg"){
    btn.disabled=false;
    btn.onclick=nextStep;
    return;
  }

  if(q.type==="radio"||q.type==="trick"){
    q.options.forEach(opt=>{
      const l=document.createElement("label");
      l.innerHTML=`<input type="radio" name="ans"> ${opt}`;
      oEl.appendChild(l);
    });
    document.querySelectorAll("input").forEach(r=>r.onchange=()=>btn.disabled=false);
  }

  if(q.type==="text"||q.type==="text10"){
    const t=document.createElement("textarea");
    oEl.appendChild(t);
    t.oninput=()=>{
      btn.disabled = q.type==="text10"
        ? t.value.trim().split(/\s+/).length<10
        : t.value.trim()==="";
    };
  }

  if(q.type==="slider"||q.type==="trickSlider"){
    const r=document.createElement("input");
    r.type="range"; r.min=1; r.max=10; r.value=5;
    const v=document.createElement("div");
    v.className="rangeValue";
    v.textContent="Value: 5";
    r.oninput=()=>{v.textContent="Value: "+r.value; btn.disabled=false;};
    oEl.appendChild(r); oEl.appendChild(v);
  }

  btn.onclick=nextStep;
}

function nextStep(){
  if(activeTrick){
    if(activeTrick.type==="trick"){
      const v=document.querySelector("input:checked").nextSibling.textContent.trim();
      if(v!==activeTrick.correct){ disqualify("You failed a trick question."); return; }
    }
    if(activeTrick.type==="trickSlider"){
      const v=document.querySelector("input[type=range]").value;
      if(+v!==activeTrick.correct){ disqualify("You failed a trick question."); return; }
    }
  }

  step++;

  if(level===0 && step===level0.length){
    lvlText.style.display="none";
    qEl.textContent="YOU HAVE QUALIFIED FOR THE REAL SURVEYS!!!";
    oEl.innerHTML="";
    btn.disabled=false;
    btn.onclick=startLevel1;
    return;
  }

  if(level===1 && step>0){
    trickChance=Math.min(trickChance+0.01,15);
  }

  if(level===1 && step>20){
    qEl.textContent="End of Survey";
    oEl.innerHTML="";
    btn.style.display="none";
    return;
  }

  load();
}

function startLevel1(){
  level=1; step=0;
  lvlText.textContent="Level 1: The real survey";
  lvlText.style.display="block";
  btn.style.display="inline-block";
  load();
}

load();
</script>

</body>
</html>
