<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f1220;
  --card:#161a2e;
  --accent:#7cf3c0;
  --danger:#ff6b6b;
  --text:#e9ecff;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,Arial;
  overflow:hidden;
}
canvas{position:fixed;inset:0;z-index:0}
#app{position:relative;z-index:2;min-height:100vh;display:flex;align-items:center;justify-content:center}
.card{
  width:90%;max-width:760px;
  background:rgba(22,26,46,.94);
  padding:26px;border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,.5)
}
.top{display:flex;justify-content:space-between;font-size:14px}
.warn{color:var(--danger)}
.progress{height:12px;background:#22286b;border-radius:999px;overflow:hidden;margin:12px 0}
.progress div{height:100%;background:linear-gradient(90deg,var(--accent),#8fd3ff)}
textarea{
  width:100%;min-height:120px;
  background:#0e1230;color:white;
  border-radius:14px;border:1px solid rgba(255,255,255,.2);
  padding:14px
}
button{
  background:linear-gradient(180deg,#8af3c8,#57d6a1);
  border:none;padding:12px 18px;
  border-radius:14px;font-weight:700;cursor:pointer
}
button:disabled{opacity:.4}
.center{text-align:center}
.row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="app"></div>

<script>
/* ========== PARTICLES ========== */
const c=document.getElementById("bg"),x=c.getContext("2d");
let W,H,p=[];
function r(){W=c.width=innerWidth;H=c.height=innerHeight}
addEventListener("resize",r);r();
for(let i=0;i<120;i++)p.push({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4,r:Math.random()*2});
(function a(){
  x.clearRect(0,0,W,H);
  for(const o of p){
    o.x+=o.vx;o.y+=o.vy;
    if(o.x<0||o.x>W)o.vx*=-1;
    if(o.y<0||o.y>H)o.vy*=-1;
    x.beginPath();x.arc(o.x,o.y,o.r,0,Math.PI*2);
    x.fillStyle="rgba(124,243,192,.35)";x.fill()
  }
  requestAnimationFrame(a)
})();

/* ========== QUESTIONS ========== */
const QUESTIONS=[
"What does success mean to you?",
"What motivates you to stay focused?",
"How do you handle stress?",
"What skill are you improving?",
"What makes work meaningful?",
"What inspires creativity?",
"What defines progress?",
"What keeps you motivated?",
"What builds confidence?",
"What does leadership mean?",
"What helps teamwork succeed?",
"What drives improvement?",
"What inspires learning?",
"What keeps you disciplined?",
"What defines balance?",
"What motivates long-term goals?",
"What helps overcome setbacks?",
"What makes goals worthwhile?",
"What encourages growth?",
"What does responsibility mean?"
];

const app=document.getElementById("app");

/* ========== STATE (WITH AUTO-REPAIR) ========== */
let state;
try{
  state=JSON.parse(localStorage.getItem("save"))||{};
}catch{state={}}

state.q ??= 0;
state.trickChance ??= 5;
state.inTrick = !!state.trick;
state.trick ??= null;

function save(){localStorage.setItem("save",JSON.stringify(state))}

/* ========== SURVEY ========== */
function renderSurvey(){
  save();

  if(state.trick && state.inTrick){
    renderTrick();
    return;
  }

  if(state.q>=QUESTIONS.length){
    app.innerHTML=`<div class="card center">
      <h2>Survey Complete ðŸŽ‰</h2>
      <button onclick="reset()">Start Over</button>
    </div>`;
    return;
  }

  const pct=Math.round((state.q/QUESTIONS.length)*100);
  app.innerHTML=`
  <div class="card">
    <div class="top">
      <div>${state.q+1}/${QUESTIONS.length}</div>
      <div class="${state.trickChance>=50?'warn':''}">
        Trick Chance: ${state.trickChance}%
      </div>
    </div>
    <div class="progress"><div style="width:${pct}%"></div></div>
    <p>${QUESTIONS[state.q]}</p>
    <textarea id="ans"></textarea>
    <div class="row">
      <button id="next" disabled>Continue</button>
    </div>
  </div>`;

  const ans=document.getElementById("ans");
  const next=document.getElementById("next");
  ans.oninput=()=>next.disabled=!ans.value.trim();
  next.onclick=()=>{
    state.q++;
    state.trickChance=Math.min(100,state.trickChance+1);
    if(Math.random()*100<state.trickChance) spawnTrick();
    renderSurvey();
  };
}

/* ========== TRICKS ========== */
function spawnTrick(){
  state.inTrick=true;
  const r=Math.random();
  if(r<.25) state.trick={type:"letter"};
  else if(r<.5) state.trick={type:"image"};
  else if(r<.75) state.trick={type:"slider",target:1+Math.floor(Math.random()*10)};
  else state.trick={type:"clicker"};
}

function renderTrick(){
  const t=state.trick;
  if(!t){state.inTrick=false;renderSurvey();return;}

  if(t.type==="letter")
    app.innerHTML=`<div class="card center">
      <h3>Select D</h3>
      ${["A","B","C","D"].map(l=>`<button onclick="lPick('${l}')">${l}</button>`).join("")}
    </div>`;

  if(t.type==="image")
    app.innerHTML=`<div class="card center">
      <p>Which is a tomato?</p>
      <div class="row">
        ${["Corn","Tomato","Egg","Avocado"].map(o=>`<button onclick="iPick('${o}')">${o}</button>`).join("")}
      </div>
    </div>`;

  if(t.type==="slider")
    app.innerHTML=`<div class="card center">
      <h3>Slide to ${t.target}</h3>
      <input type="range" id="s" min="1" max="10">
      <button onclick="sPick()">Submit</button>
    </div>`;

  if(t.type==="clicker")
    app.innerHTML=`<div class="card center">
      <h3>Click to Continue</h3>
      <button onclick="passTrick()">Click Me</button>
    </div>`;
}

function lPick(l){l==="D"?passTrick():reset()}
function iPick(o){o==="Tomato"?passTrick():reset()}
function sPick(){document.getElementById("s").value==state.trick.target?passTrick():reset()}
function passTrick(){state.trick=null;state.inTrick=false;renderSurvey()}
function reset(){localStorage.removeItem("save");location.reload()}

/* ========== START ========== */
renderSurvey();
</script>
</body>
</html>
