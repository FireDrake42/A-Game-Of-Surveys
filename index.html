<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<style>
html,body{
  margin:0;padding:0;
  background:#050814;color:white;
  font-family:system-ui,sans-serif;
  overflow:hidden;
}
#particles-js{
  position:fixed;width:100%;height:100%;z-index:-1;
}
#app{max-width:900px;margin:auto;padding:30px}
button{padding:14px 20px;border:none;border-radius:12px;font-size:16px;cursor:pointer}
.primary{background:#4f7cff;color:white}
.secondary{background:#333;color:white}
.choice{display:block;width:100%;margin:8px 0}
.progress{height:10px;background:#222;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:#4f7cff}
.fade{animation:fade .4s}
@keyframes fade{from{opacity:0}to{opacity:1}}

.topLeft{
  position:fixed;
  top:10px;
  left:10px;
  font-weight:bold;
}
.topLeft div{margin-bottom:6px}

.card{
  background:#0b1024;
  padding:16px;
  border-radius:14px;
  margin:12px 0;
}
.shopBtn{width:100%;margin:6px 0}
</style>
</head>

<body>

<div id="particles-js"></div>

<div class="topLeft">
  <div id="coinsUI">ğŸª™ Coins: 0</div>
  <div id="trickUI">ğŸ² Trick Chance: 5%</div>
  <div id="skipUI">â­ Skip Chance: 0%</div>
  <div id="doubleUI">ğŸª™ Double Coin Chance: 0%</div>
</div>

<div id="app"></div>

<script>
/* ================= PARTICLES ================= */
particlesJS("particles-js",{
  particles:{number:{value:60},color:{value:"#4f7cff"},size:{value:2},move:{enable:true,speed:1}},
  interactivity:{events:{onhover:{enable:true,mode:"repulse"}}}
});

/* ================= STATE (NORMALIZED) ================= */
let state = JSON.parse(localStorage.getItem("surveyState")) || {};
state.step ??= 0;
state.coins ??= 0;
state.answers ??= {};
state.trickChance ??= 5;
state.skipChance ??= 0;
state.doubleCoinChance ??= 0;

/* ================= SURVEY ================= */
const survey = [
  {type:"info", text:"The first questions collect personal information."},
  {type:"choice", q:"What is your gender?", o:["Man","Woman"]},
  {type:"choice", q:"Your age?", o:["-18","20-30","30-40","40-50","50+"]},
  {type:"input", q:"Zip Code (numbers only)"}
];

/* ================= RENDER ================= */
function render(){
  $("coinsUI").textContent="ğŸª™ Coins: "+state.coins;
  $("trickUI").textContent="ğŸ² Trick Chance: "+state.trickChance.toFixed(1)+"%";
  $("skipUI").textContent="â­ Skip Chance: "+state.skipChance.toFixed(2)+"%";
  $("doubleUI").textContent="ğŸª™ Double Coin Chance: "+state.doubleCoinChance.toFixed(2)+"%";

  const q = survey[state.step];
  if(!q) return endSurvey();

  let html=`<div class="fade">
    <div class="progress"><div style="width:${(state.step/survey.length)*100}%"></div></div>`;

  if(q.type==="info"){
    html+=`<p>${q.text}</p><button class="primary" onclick="next()">Continue</button>`;
  }

  if(q.type==="choice"){
    html+=`<h3>${q.q}</h3>`;
    q.o.forEach(o=>{
      html+=`<button class="choice primary" onclick="answer('${o}')">${o}</button>`;
    });
  }

  if(q.type==="input"){
    html+=`
      <h3>${q.q}</h3>
      <input id="inp" style="width:100%;padding:12px"><br><br>
      <button class="primary" onclick="answerInput()">Continue</button>
    `;
  }

  html+=`</div>`;
  $("app").innerHTML=html;
}

/* ================= ANSWERS ================= */
function answer(v){
  state.answers[state.step]=v;
  gainCoins();
  advance();
}

function answerInput(){
  const v=$("inp").value.trim();
  if(!v) return;
  state.answers[state.step]=v;
  gainCoins();
  advance();
}

function gainCoins(){
  state.coins += (Math.random()*100 < state.doubleCoinChance) ? 2 : 1;
}

function advance(){
  state.step++;
  state.trickChance = Math.min(100, state.trickChance + 1);
  save(); render();
}

function next(){ advance(); }

/* ================= END + SHOP + MORE SURVEYS ================= */
function endSurvey(){
  $("app").innerHTML=`
    <h2>Survey Complete</h2>

    <div class="card">
      <h3>Shop</h3>
      <button class="shopBtn primary" onclick="buySkip()">
        â­ Skip Chance +0.25% (Cost: 100 ğŸª™)
      </button>
      <button class="shopBtn primary" onclick="buyDouble()">
        ğŸª™ Double Coin Chance +0.75% (Cost: 40 ğŸª™)
      </button>
    </div>

    <div class="card">
      <h3>More Surveys</h3>
      ${renderSurveyCards()}
    </div>

    <button class="secondary" onclick="restart()">Start Over Survey</button>
  `;
}

function renderSurveyCards(){
  let out="";
  for(let i=0;i<3;i++){
    const reward=(Math.random()*0.6+0.2).toFixed(2);
    const time=Math.floor(Math.random()*10)+10;
    const users=Math.floor(Math.random()*100)+20;
    out+=`
      <div class="card">
        ğŸ’µ $${reward} â€¢ â± ${time} min â€¢ ğŸ‘¥ ${users} users
        <br><button class="primary" onclick="restart()">Start Survey</button>
      </div>`;
  }
  return out;
}

/* ================= SHOP ================= */
function buySkip(){
  if(state.coins>=100){
    state.coins-=100;
    state.skipChance=Math.min(1,state.skipChance+.25);
    save(); render();
  }
}
function buyDouble(){
  if(state.coins>=40){
    state.coins-=40;
    state.doubleCoinChance=Math.min(40,state.doubleCoinChance+.75);
    save(); render();
  }
}

/* ================= UTILS ================= */
function restart(){
  state.step=0;
  state.answers={};
  save(); render();
}
function save(){localStorage.setItem("surveyState",JSON.stringify(state))}
const $=id=>document.getElementById(id);

render();
</script>
</body>
</html>
