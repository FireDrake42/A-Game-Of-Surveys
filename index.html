<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#fff;
}
#top{
  display:flex;
  justify-content:space-between;
  padding:15px;
}
#progressText{font-size:18px}
#progressOuter{
  width:300px;height:18px;
  background:#ddd;border-radius:10px;
}
#progressInner{
  height:100%;width:0%;
  background:#4caf50;border-radius:10px;
}
#container{
  text-align:center;
  margin-top:60px;
}
.option{margin:8px}
button{padding:10px 20px;font-size:16px;margin:10px}
textarea{width:320px;height:80px}
input[type=range]{width:300px}
img{max-width:200px;margin:15px}
</style>
</head>

<body>

<div id="top">
  <div>
    <div id="progressText"></div>
    <div id="progressOuter"><div id="progressInner"></div></div>
  </div>
  <div id="trickInfo"></div>
</div>

<div id="container"></div>

<script>
/* ================= GLOBAL STATE ================= */
let level = 0;
let step = 0;
let trickChance = 2; // starts at 2%
let currentQuestion = null;
let clickerScore = 0;

/* ================= SAVE / LOAD ================= */
function save(){
  localStorage.setItem("surveySave",
    JSON.stringify({level,step,trickChance,clickerScore})
  );
}
function load(){
  const d = localStorage.getItem("surveySave");
  if(!d) return false;
  try{
    const s = JSON.parse(d);
    level = s.level ?? 0;
    step = s.step ?? 0;
    trickChance = s.trickChance ?? 2;
    clickerScore = s.clickerScore ?? 0;
    return true;
  }catch{return false;}
}
function resetAll(){
  localStorage.clear();
  level=0;step=0;trickChance=2;clickerScore=0;
  render();
}

/* ================= QUESTIONS ================= */
const level1Questions = [
 "What motivates you to succeed?",
 "How do you handle stress?",
 "What makes a task feel rewarding?",
 "How do you stay focused?",
 "How do you overcome failure?",
 "What inspires improvement?",
 "Do you prefer routine or variety?",
 "How adaptable are you?",
 "What keeps you disciplined?",
 "Was it hard to achieve your goals?"
];

const level2Questions = [
 "Describe a difficult challenge you faced.",
 "How do you manage time effectively?",
 "What helps you stay productive?",
 "How do you handle pressure?",
 "What distracts you most?",
 "How do you stay organized?",
 "What improves your performance?",
 "How do you overcome frustration?",
 "How do you balance work and rest?",
 "What habits help you succeed?"
];

/* ================= QUESTION GENERATOR ================= */
function generateQuestion(){
  // Trick question chance
  if(level>=1 && Math.random()*100 < trickChance){
    // 10% clicker
    if(Math.random()<0.10){
      return {type:"clicker"};
    }
    // 20% image trick
    if(Math.random()<0.20){
      return {
        type:"image",
        text:"What is shown in the image?",
        options:["Corn","Tomato","Egg","Avocado"],
        correct:"Tomato"
      };
    }
    // Letter trick
    const letters=["A","B","C","D"];
    const correct=letters[Math.floor(Math.random()*4)];
    return {
      type:"letter",
      text:`Verification check: Please select "${correct}".`,
      options:letters,
      correct
    };
  }

  const list = level===1 ? level1Questions : level2Questions;
  const text = list[step];
  if(!text) return null;

  if(text.includes("hard")){
    return {type:"slider",text,min:1,max:10};
  }
  if(text.includes("Describe")){
    return {type:"text",text};
  }
  return {type:"radio",text,options:["Yes","No"]};
}

/* ================= RENDER ================= */
function render(){
  const c = document.getElementById("container");
  const p = document.getElementById("progressText");
  const bar = document.getElementById("progressInner");
  const trick = document.getElementById("trickInfo");

  if(level===0){
    c.innerHTML = `
      <h2>Hello!</h2>
      <p>This survey will take ~7 minutes.</p>
      <button onclick="level=1;step=0;render()">Start</button>
      <br><button onclick="load()?render():alert('No save')">Resume</button>
    `;
    p.textContent="";
    trick.textContent="";
    bar.style.width="0%";
    return;
  }

  const total = level===1 ? 20 : 40;
  p.textContent = `${step}/${total}`;
  bar.style.width = (step/total*100)+"%";
  trick.textContent = `Trick Chance: ${trickChance.toFixed(2)}%`;

  currentQuestion = generateQuestion();
  if(!currentQuestion){
    level++;
    step=0;
    trickChance=level===2?0.1:2;
    render();
    return;
  }

  // CLICKER
  if(currentQuestion.type==="clicker"){
    c.innerHTML = `
      <h2>Verification Challenge</h2>
      <p>Reach 1,000,000 points</p>
      <h3>${clickerScore.toLocaleString()}</h3>
      <button onclick="clicker()">Click Me</button>
      ${clickerScore>=1000000?'<br><button onclick="finish()">Continue</button>':''}
    `;
    save();
    return;
  }

  // IMAGE
  if(currentQuestion.type==="image"){
    c.innerHTML = `
      <h2>${currentQuestion.text}</h2>
      <img src="tomato.png">
      ${currentQuestion.options.map(o=>`
        <div><input type="radio" name="a" value="${o}">${o}</div>
      `).join("")}
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  // LETTER
  if(currentQuestion.type==="letter"){
    c.innerHTML = `
      <h2>${currentQuestion.text}</h2>
      ${currentQuestion.options.map(o=>`
        <div><input type="radio" name="a" value="${o}">${o}</div>
      `).join("")}
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  // SLIDER
  if(currentQuestion.type==="slider"){
    c.innerHTML = `
      <h2>${currentQuestion.text}</h2>
      <input type="range" id="s" min="1" max="10">
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  // TEXT
  if(currentQuestion.type==="text"){
    c.innerHTML = `
      <h2>${currentQuestion.text}</h2>
      <textarea id="t"></textarea>
      <button onclick="submit()">Continue</button>
    `;
    return;
  }

  // RADIO
  c.innerHTML = `
    <h2>${currentQuestion.text}</h2>
    ${currentQuestion.options.map(o=>`
      <div><input type="radio" name="a" value="${o}">${o}</div>
    `).join("")}
    <button onclick="submit()">Continue</button>
  `;
}

/* ================= LOGIC ================= */
function submit(){
  // validation
  if(currentQuestion.type==="letter" || currentQuestion.type==="image"){
    const v = document.querySelector("input[name=a]:checked");
    if(!v || v.value!==currentQuestion.correct){
      resetAll(); alert("Disqualified");
      return;
    }
  }
  if(currentQuestion.type==="text"){
    const t=document.getElementById("t").value.trim();
    if(t.split(" ").length<5){
      resetAll(); alert("Invalid answer");
      return;
    }
  }
  step++;
  trickChance = Math.min(trickChance+0.01,15);
  save();
  render();
}

function clicker(){
  clickerScore += 1;
  save();
  render();
}

function finish(){
  clickerScore=0;
  step++;
  save();
  render();
}

render();
</script>
</body>
</html>
