<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#0f1220;
  color:#e9ecff;
}
#ui{
  max-width:760px;
  margin:40px auto;
  background:#161a2e;
  padding:24px;
  border-radius:16px;
  box-shadow:0 20px 50px rgba(0,0,0,.4);
}
button{
  padding:12px 18px;
  border:none;
  border-radius:12px;
  font-weight:700;
  background:#7cf3c0;
  cursor:pointer;
}
.row{display:flex;gap:12px;flex-wrap:wrap}
.progress{height:10px;background:#22286b;border-radius:999px;overflow:hidden}
.progress>div{height:100%;background:#7cf3c0}
.badge{font-size:14px}
.coin{position:fixed;top:12px;left:12px;font-weight:700}
.float{
  position:absolute;
  font-size:28px;
  pointer-events:none;
  animation:float 1s ease-out forwards;
}
@keyframes float{
  from{opacity:1;transform:translateY(0)}
  to{opacity:0;transform:translateY(-40px)}
}
</style>
</head>

<body>
<div class="coin" id="coinUI">ðŸª™ 0</div>
<div id="ui"></div>

<script>
/* ===================== STATE ===================== */
const state = JSON.parse(localStorage.getItem("survey_state")) || {
  q:0,
  coins:0,
  trickChance:5,
  inTrick:false
};
function save(){ localStorage.setItem("survey_state",JSON.stringify(state)); }
function resetSurvey(){
  state.q=0;
  state.trickChance=5;
  state.inTrick=false;
  save();
  render();
}

/* ===================== AUDIO (EMBEDDED) ===================== */
const audioData = {
  birds: "data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAA==", // placeholder tiny sound
  wolf: "data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAA==",
  traffic: "data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAA=="
};
let heardSound=null;

/* ===================== QUESTIONS ===================== */
const questions = [
  {type:"intro",text:"The first questions collect personal information."},
  {type:"sound"},
  {type:"choice",text:"What did you hear?",opts:["Birds","Wolf","Traffic"],check:true},
  {type:"choice",text:"What is your gender?",opts:["Man","Woman"]},
  {type:"choice",text:"What is your age?",opts:["-18","20-30","30-40","40-50","50-60","60-70","+70"]},
  {type:"text",text:"What does success mean to you?"},
  {type:"slider",text:"How motivated are you?",min:1,max:10}
];
while(questions.length<20){
  questions.push({type:"text",text:"Describe a goal you want to achieve."});
}

/* ===================== RENDER ===================== */
const ui=document.getElementById("ui");
function render(){
  document.getElementById("coinUI").innerText="ðŸª™ "+state.coins;

  if(state.inTrick) return renderTrick();
  if(state.q>=20) return finish();

  const q=questions[state.q];
  let html=`
    <div class="badge">Question ${state.q+1}/20</div>
    <div class="badge">Trick Chance: ${state.trickChance}%</div>
    <div class="progress"><div style="width:${state.q/20*100}%"></div></div>
    <p>${q.text||""}</p>
  `;

  if(q.type==="intro"){
    html+=`<button onclick="next()">Continue</button>`;
  }

  if(q.type==="sound"){
    const keys=Object.keys(audioData);
    heardSound=keys[Math.floor(Math.random()*keys.length)];
    html+=`
      <button id="playBtn">Play Audio</button>
      <button id="contBtn" disabled>Continue</button>
    `;
    ui.innerHTML=html;
    const a=new Audio(audioData[heardSound]);
    document.getElementById("playBtn").onclick=()=>a.play();
    a.onended=()=>document.getElementById("contBtn").disabled=false;
    document.getElementById("contBtn").onclick=next;
    return;
  }

  if(q.type==="choice"){
    html+=`<div class="row">${q.opts.map(o=>`<button onclick="pick('${o}')">${o}</button>`).join("")}</div>`;
  }

  if(q.type==="text"){
    html+=`<textarea id="txt"></textarea><button onclick="submitText()">Continue</button>`;
  }

  if(q.type==="slider"){
    html+=`
      <input type="range" min="${q.min}" max="${q.max}" value="5" id="sl">
      <div id="sv">5</div>
      <button onclick="next()">Continue</button>
    `;
  }

  ui.innerHTML=html;
  const sl=document.getElementById("sl");
  if(sl) sl.oninput=()=>sv.innerText=sl.value;
}

/* ===================== ANSWERS ===================== */
function next(){
  state.coins++;
  state.q++;
  maybeTrick();
  save();
  render();
}
function pick(v){
  const q=questions[state.q];
  if(q.check && v!==heardSound.charAt(0).toUpperCase()+heardSound.slice(1)) return disqualify();
  next();
}
function submitText(){
  const t=document.getElementById("txt").value.trim();
  if(t.split(/\s+/).length<2) return;
  next();
}

/* ===================== TRICKS ===================== */
function maybeTrick(){
  if(Math.random()*100<state.trickChance){
    state.inTrick=true;
    spawnTrick();
  }
  state.trickChance=Math.min(100,state.trickChance+1);
}
let trick=null;

/* ===================== CLICKER ===================== */
function spawnTrick(){
  const r=Math.random();
  if(r<0.25) trick={type:"letter"};
  else if(r<0.5) trick={type:"image"};
  else if(r<0.75) trick={type:"slider"};
  else trick={type:"clicker",score:0,ppc:1,target:Math.floor(Math.random()*900)+100};
}
function renderTrick(){
  if(trick.type==="clicker"){
    ui.innerHTML=`
      <h2>Verification</h2>
      <p>${trick.score}/${trick.target}</p>
      <button id="clickBtn">CLICK</button>
      <div class="progress"><div style="width:${trick.score/trick.target*100}%"></div></div>
    `;
    document.getElementById("clickBtn").onclick=(e)=>{
      trick.score+=trick.ppc;
      floatText("+"+trick.ppc,e.clientX,e.clientY);
      if(trick.score>=trick.target){
        state.inTrick=false;
        save();
        render();
      }else renderTrick();
    };
    return;
  }

  if(trick.type==="letter"){
    ui.innerHTML=`<p>Select D</p><div class="row">${["A","B","C","D"].map(l=>`<button onclick="${l==="D"?"pass()":"disqualify()"}">${l}</button>`).join("")}</div>`;
  }
  if(trick.type==="image"){
    ui.innerHTML=`<p>What is this?</p><img src="tomato.png" width="120"><div class="row"><button onclick="pass()">Tomato</button><button onclick="disqualify()">Corn</button></div>`;
  }
  if(trick.type==="slider"){
    const t=Math.floor(Math.random()*10)+1;
    trick.correct=t;
    ui.innerHTML=`<p>Slide to ${t}</p><input type="range" min="1" max="10" id="ts"><button onclick="checkSlider()">Submit</button>`;
  }
}
function checkSlider(){
  if(document.getElementById("ts").value==trick.correct) pass();
  else disqualify();
}
function pass(){
  state.inTrick=false;
  save();
  render();
}
function disqualify(){
  ui.innerHTML=`<h1>Disqualified</h1><button onclick="resetSurvey()">Restart</button>`;
}

/* ===================== FLOAT TEXT ===================== */
function floatText(txt,x,y){
  const d=document.createElement("div");
  d.className="float";
  d.innerText=txt;
  d.style.left=x+"px";
  d.style.top=y+"px";
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),1000);
}

/* ===================== FINISH ===================== */
function finish(){
  ui.innerHTML=`
    <h1>Survey Completed</h1>
    <p>You earned coins.</p>
    <button onclick="resetSurvey()">Start Over Survey</button>
  `;
}

render();
</script>
</body>
</html>
