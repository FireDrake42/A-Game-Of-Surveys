<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A Game Of Surveys</title>

<style>
body{font-family:Arial;margin:0}
#top{display:flex;justify-content:space-between;padding:15px}
#progressText{font-size:18px}
#progressOuter{width:320px;height:18px;background:#ddd;border-radius:10px}
#progressInner{height:100%;width:0%;background:#4caf50}
#container{text-align:center;margin-top:50px}
button{padding:10px 20px;margin:8px}
textarea{width:340px;height:90px}
input[type=range]{width:300px}
.warning{color:red;font-weight:bold}
.small{font-size:14px;color:#555}
</style>
</head>

<body>

<div id="top">
  <div>
    <div id="progressText"></div>
    <div id="progressOuter"><div id="progressInner"></div></div>
    <div class="small" id="growthInfo"></div>
  </div>
  <div id="trickInfo"></div>
</div>

<div id="container"></div>

<script>
/* ========== STATE ========== */
let level=0, step=0;
let trickChance=2;
let currentQuestion=null;
let inClicker=false;

/* Clicker */
let clickerScore=0;
let clickerPower=1;
let clickTimes=[];

/* ========== LEVEL CONFIG ========== */
const levelSizes={1:10,2:20,3:40,4:60};

function getGrowth(){
  return level===0?0:
         level===1?0.1:
         level===2?0.33:
         level===3?1:5;
}

/* ========== SAVE / LOAD ========== */
function save(){
  localStorage.setItem("surveySave",JSON.stringify({
    level,step,trickChance,inClicker,
    clickerScore,clickerPower,clickTimes
  }));
}
function load(){
  const d=localStorage.getItem("surveySave");
  if(!d) return false;
  Object.assign(window,JSON.parse(d));
  return true;
}
function resetAll(){
  localStorage.clear();
  location.reload();
}

/* ========== QUESTIONS ========== */
const baseQuestions=[
 "What does success mean to you?",
 "How do you stay motivated?",
 "How do you deal with failure?",
 "What makes work meaningful?",
 "How do you manage stress?",
 "What keeps you disciplined?",
 "How do you improve yourself?",
 "What motivates long-term goals?",
 "How do you define achievement?",
 "What drives personal growth?"
];

/* ========== VALIDATION ========== */
function isRelevant(answer,question){
  const qWords=question.toLowerCase().split(/\W+/).filter(w=>w.length>3);
  const a=answer.toLowerCase();
  let hits=0;
  qWords.forEach(w=>{if(a.includes(w)) hits++;});
  return hits>=2 && answer.split(/\s+/).length>=8;
}

/* ========== QUESTION GENERATION ========== */
function generateQuestion(){
  if(level>=1 && Math.random()*100<trickChance){
    if(Math.random()<0.15){inClicker=true;return {type:"clicker"};}
    const letters=["A","B","C","D"];
    const c=letters[Math.floor(Math.random()*4)];
    return {type:"letter",correct:c};
  }
  const q=baseQuestions[step%baseQuestions.length];
  return {type:"text",text:q};
}

/* ========== RENDER ========== */
function render(){
  const c=document.getElementById("container");
  const p=document.getElementById("progressText");
  const bar=document.getElementById("progressInner");
  const trick=document.getElementById("trickInfo");
  const growth=document.getElementById("growthInfo");

  growth.textContent=`Growth Rate: +${getGrowth()}% / question`;

  if(level===0){
    c.innerHTML=`
      <h2>Hello!</h2>
      <p>This survey will take time. Answer honestly.</p>
      <button onclick="level=1;step=0;render()">Start</button>
      <button onclick="load()?render():alert('No save')">Resume</button>
      <br><button onclick="resetAll()">Start Over</button>
    `;
    p.textContent="";bar.style.width="0%";trick.textContent="";
    return;
  }

  const total=levelSizes[level];
  p.textContent=`${step}/${total}`;
  bar.style.width=(step/total*100)+"%";

  trick.innerHTML=trickChance>=50
    ? `<span class="warning">âš  Trick Chance: ${trickChance.toFixed(2)}%</span>`
    : `Trick Chance: ${trickChance.toFixed(2)}%`;

  if(inClicker){renderClicker();return;}

  currentQuestion=generateQuestion();
  c.innerHTML=currentQuestion.type==="letter"
    ? `<h2>Select "${currentQuestion.correct}"</h2>
       ${["A","B","C","D"].map(o=>`<div><input type="radio" name="a" value="${o}">${o}</div>`).join("")}
       <button onclick="submit()">Continue</button>`
    : `<h2>${currentQuestion.text}</h2>
       <textarea id="t"></textarea>
       <button onclick="submit()">Continue</button>`;
}

/* ========== CLICKER ========== */
function renderClicker(){
  const c=document.getElementById("container");
  const cps=getCPS();
  if(cps>=15){alert("Auto-click detected");resetAll();return;}

  c.innerHTML=`
    <h2>Verification Challenge</h2>
    <div>${clickerScore.toLocaleString()} / 1,000,000</div>
    <div>CPS: ${cps.toFixed(2)}</div>
    <div style="width:300px;height:14px;background:#ddd;margin:auto">
      <div style="width:${Math.min(clickerScore/1000000*100,100)}%;height:100%;background:#4caf50"></div>
    </div>
    <button onclick="click()">Click Me</button>
    <br>
    <button onclick="buy(1,1000)">+1 (1k)</button>
    <button onclick="buy(10,10000)">+10 (10k)</button>
    <button onclick="buy(100,100000)">+100 (100k)</button>
    ${clickerScore>=1000000?'<br><button onclick="finishClicker()">Continue</button>':''}
  `;
  save();
}
function click(){
  const now=Date.now();
  clickTimes.push(now);
  clickTimes=clickTimes.filter(t=>now-t<1000);
  clickerScore+=clickerPower;
  save();render();
}
function getCPS(){
  const now=Date.now();
  clickTimes=clickTimes.filter(t=>now-t<1000);
  return clickTimes.length;
}
function buy(p,c){
  if(clickerScore<c) return;
  clickerScore-=c;
  clickerPower+=p;
  save();render();
}
function finishClicker(){
  inClicker=false;
  clickerScore=0;clickerPower=1;clickTimes=[];
  step++;applyGrowth(true);
  render();
}

/* ========== SUBMIT ========== */
function submit(){
  if(currentQuestion.type==="letter"){
    const v=document.querySelector("input[name=a]:checked");
    if(!v||v.value!==currentQuestion.correct){resetAll();return;}
    step++;applyGrowth(true);render();return;
  }
  const a=document.getElementById("t").value.trim();
  if(!isRelevant(a,currentQuestion.text)){resetAll();return;}
  step++;applyGrowth(false);
  if(step>=levelSizes[level]){level++;step=0;}
  render();
}
function applyGrowth(isTrick){
  const g=getGrowth();
  trickChance=Math.min(trickChance+(isTrick?g/100:g),100);
  save();
}

render();
</script>
</body>
</html>
