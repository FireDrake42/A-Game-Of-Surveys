<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Survey Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#0f1220;
  color:#e9ecff;
}
#ui{
  max-width:800px;
  margin:40px auto;
  background:#161a2e;
  padding:26px;
  border-radius:18px;
  box-shadow:0 20px 60px rgba(0,0,0,.45);
}
button{
  padding:12px 20px;
  border:none;
  border-radius:14px;
  font-weight:700;
  background:#7cf3c0;
  cursor:pointer;
}
.row{display:flex;gap:12px;flex-wrap:wrap}
.badge{font-size:14px;margin-bottom:6px;color:#9aa3ff}
.progress{height:10px;background:#22286b;border-radius:999px;overflow:hidden;margin:12px 0}
.progress>div{height:100%;background:#7cf3c0}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
td,th{
  border:1px solid #2a2f6b;
  padding:10px;
  text-align:center;
  cursor:pointer;
}
td.selected{background:#7cf3c0;color:#06281a;font-weight:800}
.fade{
  animation:fadeSlide 2.5s ease forwards;
}
@keyframes fadeSlide{
  from{opacity:1;transform:translateX(0)}
  to{opacity:0;transform:translateX(-40px)}
}
</style>
</head>

<body>
<div id="ui"></div>

<script>
/* ===================== STATE / SAVE ===================== */
const state = JSON.parse(localStorage.getItem("survey_state")) || {
  step:0,
  coins:0,
  movieIndex:0,
  tableRatings:{},
  soundHeard:null
};
function save(){ localStorage.setItem("survey_state",JSON.stringify(state)); }

/* ===================== AUDIO ===================== */
function playSound(type, onEnd){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);

  if(type==="Birds"){ osc.type="sine"; osc.frequency.value=1200; }
  if(type==="Wolf"){ osc.type="sawtooth"; osc.frequency.value=220; }
  if(type==="Traffic"){ osc.type="square"; osc.frequency.value=90; }

  gain.gain.value=0.001;
  gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.1);

  osc.start();
  osc.stop(ctx.currentTime+14);

  osc.onended=()=>{
    ctx.close();
    onEnd && onEnd();
  };
}

/* ===================== MOVIES (MIXED) ===================== */
const movies=[
  "How to Train Your Dragon","Solar Drift","Echoes of Tomorrow",
  "The Last Moon","Pixel Knights","Iron Skies","Dreamfall City",
  "Neon Harbor","Shadow of Atlantis","Starlight Run",
  "Quantum Heist","Frozen Horizon","The Paper Giant",
  "Crimson Orbit","Glass Kingdom","Midnight Engine",
  "Aurora Protocol","Skybound","Lost in Marble",
  "Digital Wolves","The Silent Metro","Golden Circuit",
  "Parallel Summer","Nova Street","Forgotten Signal",
  "The Clockmaker","Phantom Signal","Blue Orbit",
  "Hollow Lights","Beyond the Static"
];

/* ===================== RENDER ===================== */
const ui=document.getElementById("ui");

function render(){
  if(state.step===0) return intro();
  if(state.step===1) return soundCheck();
  if(state.step===2) return soundAnswer();
  if(state.step>=3 && state.step<=7) return personalInfo();
  if(state.step===8) return movieBatch();
  if(state.step===9) return tableRating();
  finish();
}

/* ===================== SCREENS ===================== */
function intro(){
  ui.innerHTML=`
    <h2>Welcome</h2>
    <p>The first few questions collect personal information and are not part of the survey.</p>
    <button onclick="next()">Continue</button>
  `;
}

function soundCheck(){
  const sounds=["Birds","Wolf","Traffic"];
  state.soundHeard=sounds[Math.floor(Math.random()*sounds.length)];
  save();
  ui.innerHTML=`
    <h3>Please listen carefully</h3>
    <button id="play">â–¶ Play Sound</button>
    <button id="cont" disabled>Continue</button>
  `;
  let played=false;
  play.onclick=()=>{
    if(played) return;
    played=true;
    playSound(state.soundHeard,()=>cont.disabled=false);
  };
  cont.onclick=next;
}

function soundAnswer(){
  ui.innerHTML=`
    <h3>What did you hear?</h3>
    <div class="row">
      ${["Birds","Wolf","Traffic"].map(o=>`<button onclick="pickSound('${o}')">${o}</button>`).join("")}
    </div>
  `;
}
function pickSound(v){
  if(v!==state.soundHeard) return disqualify();
  next();
}

const infoQuestions=[
  {q:"What is your gender?",opts:["Man","Woman"]},
  {q:"What is your age?",opts:["-18","20-30","30-40","40-50","50-60","60-70","+70"]},
  {q:"What is your ZIP code?",text:true},
  {q:"What is your marital status?",opts:["Single","Divorced","Family"]},
  {q:"Did you buy a car over 5 years?",opts:["Yes","No"],kickOn:"No"}
];

function personalInfo(){
  const i=state.step-3;
  const q=infoQuestions[i];
  let html=`<h3>${q.q}</h3>`;
  if(q.opts){
    html+=`<div class="row">${q.opts.map(o=>`<button onclick="pickInfo('${o}')">${o}</button>`).join("")}</div>`;
  } else {
    html+=`<input id="txt"><button onclick="next()">Continue</button>`;
  }
  ui.innerHTML=html;
}
function pickInfo(v){
  const q=infoQuestions[state.step-3];
  if(q.kickOn && v===q.kickOn) return disqualify();
  next();
}

/* ===================== MOVIE BATCH ===================== */
function movieBatch(){
  if(state.movieIndex>=30){
    next();
    return;
  }
  const m=movies[state.movieIndex];
  ui.innerHTML=`
    <div class="badge">${state.movieIndex+1}/30</div>
    <h3 id="movie">${m}</h3>
    <div class="row">
      ${["Extremely good","Particularly good","More or less","Particularly bad","Extremely bad"]
        .map(o=>`<button onclick="rateMovie()">${o}</button>`).join("")}
    </div>
  `;
}
function rateMovie(){
  const el=document.getElementById("movie");
  el.classList.add("fade");
  setTimeout(()=>{
    state.movieIndex++;
    save();
    movieBatch();
  },2500);
}

/* ===================== TABLE RATING ===================== */
const carModels=["GoldCar","Pro%","Sixt","Ford"];
function tableRating(){
  let rows=carModels.map(m=>`
    <tr>
      <th>${m}</th>
      ${[1,2,3,4,5].map(n=>`
        <td class="${state.tableRatings[m]===n?"selected":""}"
            onclick="rateTable('${m}',${n})">${n}</td>`).join("")}
    </tr>
  `).join("");

  ui.innerHTML=`
    <h3>Rate these car models</h3>
    <table>
      <tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
      ${rows}
    </table>
    <button ${Object.keys(state.tableRatings).length<carModels.length?"disabled":""}
      onclick="next()">Continue</button>
  `;
}
function rateTable(m,n){
  state.tableRatings[m]=n;
  save();
  tableRating();
}

/* ===================== FLOW ===================== */
function next(){
  state.coins++;
  state.step++;
  save();
  render();
}
function disqualify(){
  ui.innerHTML=`<h1>Disqualified</h1><button onclick="localStorage.clear();location.reload()">Restart</button>`;
}
function finish(){
  ui.innerHTML=`
    <h1>Survey Section Complete</h1>
    <p>You may now continue.</p>
  `;
}

/* ===================== START ===================== */
render();
</script>
</body>
</html>
